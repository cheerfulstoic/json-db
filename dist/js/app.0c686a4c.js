(function(e){function t(t){for(var i,o,s=t[0],u=t[1],d=t[2],c=0,f=[];c<s.length;c++)o=s[c],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&f.push(a[o][0]),a[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);l&&l(t);while(f.length)f.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var e,t=0;t<r.length;t++){for(var n=r[t],i=!0,s=1;s<n.length;s++){var u=n[s];0!==a[u]&&(i=!1)}i&&(r.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},a={app:0},r=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/json-db/dist/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var l=u;r.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"001e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("46d1")),o=i.__importStar(n("a4c9"));t.default=a.default.extend({name:"Definition",components:{DefinitionDetails:r.default},props:{value:Object,database:o.Database},watch:{value:function(e,t){this.$emit("input",e)}},data:function(){return{modal_dom_id:"edit-definition-modal-".concat(this.value._id)}},methods:{remove:function(e,t){this.$bvModal.hide(this.modal_dom_id),this.$emit("remove",e,t)},remove_sub_definition:function(e,t,n){this.$emit("remove-sub-definition",e,t,n)},update:function(e){this.$emit("input",e)}}})},"0405":function(e,t,n){"use strict";n.r(t);var i=n("3c72"),a=n("4ff5");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"41ac5b1a",null);t["default"]=s.exports},"0452":function(e,t,n){"use strict";n.r(t);var i=n("46b6"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"0538":function(e,t,n){"use strict";n.r(t);var i=n("5f04"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"089a":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._l(e.variables,(function(t,i){return n("div",{key:i,staticClass:"row"},[n("label",{staticClass:"col",attrs:{for:"input-"+i}},[e._v(" "+e._s(i)+" "),n("span",{on:{click:function(t){return e.delete_variable(i)}}},[n("v-icon",{attrs:{name:"x"}})],1)]),n("input",{staticClass:"col",attrs:{id:"input-"+i,type:"number"},domProps:{value:t},on:{input:function(t){return e.update_variable(i,t)}}})])})),n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_key,expression:"new_key"}],attrs:{type:"text"},domProps:{value:e.new_key},on:{input:function(t){t.target.composing||(e.new_key=t.target.value)}}}),n("a",{on:{click:e.add_variable}},[e._v("Add")])],2)},a=[]},"08c6":function(e,t,n){"use strict";n.r(t);var i=n("6d8c"),a=n("6de4");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("5361");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"5f589a6e",null);t["default"]=s.exports},"094d":function(e,t,n){"use strict";n.r(t);var i=n("a6bb"),a=n("cb02");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"44475ff3",null);t["default"]=s.exports},"09d4":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("b-modal",{ref:e.modal_dom_id,attrs:{"ok-only":"",id:e.modal_dom_id,title:"BootstrapVue"}},[n("DefinitionDetails",{attrs:{value:e.value,database:e.database},on:{input:e.update,remove:e.remove,"remove-sub-definition":e.remove_sub_definition}})],1),e._v(" "+e._s(e.value.name)+" "),n("br"),e.value.unique_id?n("span",[n("v-icon",{staticStyle:{color:"red"},attrs:{name:"zap"}})],1):e._e(),n("a",{directives:[{name:"b-modal",rawName:"v-b-modal",value:e.modal_dom_id,expression:"modal_dom_id"}]},[n("v-icon",{attrs:{name:"edit"}})],1)],1)},a=[]},"0ad2":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",{staticClass:"form-group"},[n("label",[e._v(" Name "),n("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.value.name,expression:"value.name",modifiers:{lazy:!0}}],staticClass:"form-control",domProps:{value:e.value.name},on:{change:function(t){return e.$set(e.value,"name",t.target.value)}}})])]),n("div",{staticClass:"form-group"},[n("label",[e._v(" Unique ID? "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.value.unique_id,expression:"value.unique_id"}],attrs:{type:"checkbox",id:"unique_id"},domProps:{checked:Array.isArray(e.value.unique_id)?e._i(e.value.unique_id,null)>-1:e.value.unique_id},on:{change:function(t){var n=e.value.unique_id,i=t.target,a=!!i.checked;if(Array.isArray(n)){var r=null,o=e._i(n,r);i.checked?o<0&&e.$set(e.value,"unique_id",n.concat([r])):o>-1&&e.$set(e.value,"unique_id",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.value,"unique_id",a)}}})])]),n("div",{staticClass:"form-group"},[n("label",[e._v(" Type "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.value.type,expression:"value.type"}],staticClass:"form-control",on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.value,"type",t.target.multiple?n:n[0])}}},[n("option",{attrs:{disabled:"",value:""}},[e._v("Select one")]),n("option",{attrs:{value:"string"}},[e._v("String")]),n("option",{attrs:{value:"text_area"}},[e._v("Text Area")]),n("option",{attrs:{value:"integer"}},[e._v("Integer")]),n("option",{attrs:{value:"select_one"}},[e._v("Select One")]),e.sub_definition?e._e():n("option",{attrs:{value:"references"}},[e._v("References")]),n("option",{attrs:{value:"expression"}},[e._v("Expression")])])])]),"select_one"==e.value.type?n("div",{staticClass:"form-group"},[n("label",[n("b-list-group",e._l(e.options,(function(t){return n("b-list-group-item",{key:t},[n("a",{staticClass:"float-right",on:{click:function(n){return e.remove_option(t,n)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1),e._v(" "+e._s(t)+" ")])})),1),n("input",{directives:[{name:"model",rawName:"v-model",value:e.option_to_add,expression:"option_to_add"}],staticClass:"form-control",attrs:{placeholder:"New option"},domProps:{value:e.option_to_add},on:{input:function(t){t.target.composing||(e.option_to_add=t.target.value)}}}),n("b-button",{on:{click:e.add_option}},[e._v("Add Option")])],1)]):e._e(),"select_one"!=e.value.type||e.sub_definition?e._e():n("div",{staticClass:"form-group"},[n("label",[e._v(" Transform all "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.old_value,expression:"old_value"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.old_value=t.target.multiple?n:n[0]}}},e._l(e.options,(function(t){return n("option",{key:t},[e._v(e._s(t))])})),0),e._v(" to: "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.new_value,expression:"new_value"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.new_value=t.target.multiple?n:n[0]}}},e._l(e.options,(function(t){return n("option",{key:t},[e._v(e._s(t))])})),0),n("button",{staticClass:"btn btn-danger",on:{click:function(t){return e.$emit("transform-values",e.definition,e.old_value,e.new_value)}}},[e._v("Change")])])]),n("button",{staticClass:"btn btn-danger",on:{click:e.emit_remove}},[e._v("Delete Definition")]),"references"==e.value.type?n("div",{staticClass:"mt-2"},[n("div",{staticClass:"form-group"},[n("p",[e._v("Limit sheets which can be referenced (select none to allow reference of any sheet):")]),e._l(e.database.sheets,(function(t){return n("label",{key:t._id,staticClass:"referenceable-sheet-option"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value.referenceable_sheet_ids,expression:"value.referenceable_sheet_ids"}],attrs:{type:"checkbox"},domProps:{value:t._id,checked:Array.isArray(e.value.referenceable_sheet_ids)?e._i(e.value.referenceable_sheet_ids,t._id)>-1:e.value.referenceable_sheet_ids},on:{change:function(n){var i=e.value.referenceable_sheet_ids,a=n.target,r=!!a.checked;if(Array.isArray(i)){var o=t._id,s=e._i(i,o);a.checked?s<0&&e.$set(e.value,"referenceable_sheet_ids",i.concat([o])):s>-1&&e.$set(e.value,"referenceable_sheet_ids",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.value,"referenceable_sheet_ids",r)}}}),e._v(" "+e._s(t.name)+" ")])}))],2),n("div",{staticClass:"form-group"},[n("a",{staticClass:"btn btn-primary btn-block",on:{click:e.add_definition}},[e._v("Add sub-definition")]),e._l(e.value.definitions,(function(t,i){return n("div",{key:t.name,staticClass:"references-definition mt-2"},[n("DefinitionDetails",{attrs:{sub_definition:!0,database:e.database},on:{remove:e.remove},model:{value:e.definition.definitions[i],callback:function(t){e.$set(e.definition.definitions,i,t)},expression:"definition.definitions[index]"}})],1)}))],2)]):e._e()])},a=[]},"0cf2":function(e,t,n){"use strict";n.r(t);var i=n("2766"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"0d8c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e"));t.default=a.default.extend({name:"String",data:function(){return{}},props:{value:String},methods:{update_value:function(e){this.$emit("input",e.target.value)}}})},"0e4e":function(e,t,n){"use strict";n.r(t);var i=n("b19a"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"0e4e2":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group"},[n("textarea",{ref:"the_input",staticClass:"form-control",attrs:{rows:"3"},domProps:{value:e.value},on:{input:e.update_value}})])},a=[]},"0e82":function(e,t,n){"use strict";n("4de4"),n("d3b7"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("2ef0"));t.default=a.default.extend({name:"Integer",props:["definition","database","values"],data:function(){return{min:r.default.min(this.values),min_min:r.default.min(this.values),max:r.default.max(this.values),max_max:r.default.max(this.values)}},watch:{min:function(){this.emit_function()},max:function(){this.emit_function()}},methods:{reset:function(){this.min=this.min_min,this.max=this.max_max},emit_function:function(){var e=this,t=parseInt("".concat(this.min)),n=parseInt("".concat(this.max));t===this.min_min&&n===this.max_max?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(i){return r.default.filter(i,(function(i){var a=i.value_for_definition(e.definition);return a>=t&&a<=n}))}))}}})},"10ed":function(e,t,n){"use strict";n("498a"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("2ef0")),o=n("430b").Parser;t.default=a.default.extend({name:"Expression",data:function(){return{error:null}},props:{value:Object,definition:Object,global_variables:Object},watch:{global_variables:{handler:function(e,t){this.value&&this.update_value(this.value.expression_string)},deep:!0}},methods:{update_value_event:function(e){var t=e.target.value;this.update_value(t)},update_value:function(e){var t=null;if(""===r.default.trim(e))t=null,this.error=null;else{var n=new o;try{t=n.evaluate(e,this.global_variables),this.error=null}catch(i){t=null,this.error=i}}this.$emit("input",{expression_string:e,calculated_value:t})}}})},1250:function(e,t,n){"use strict";n.r(t);var i=n("8c5b"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"13c1":function(e,t,n){"use strict";n.r(t);var i=n("9177"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},1593:function(e,t,n){"use strict";n.r(t);var i=n("882e"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},2766:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e"));t.default=a.default.extend({name:"String",data:function(){return{}},props:{value:String},methods:{update_value:function(e){this.$emit("input",e.target.value)}}})},"2cf1":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"the_input",staticClass:"form-control",on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.value=t.target.multiple?n:n[0]},e.update_value]}},[n("option",{attrs:{disabled:"",value:""}},[e._v("Select one")]),e._l(e.definition.options,(function(t){return n("option",{key:t,domProps:{value:t}},[e._v(e._s(t))])}))],2)])},a=[]},"2fa3":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("nav",{staticClass:"navbar sticky-top navbar-expand-lg navbar-light bg-light"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.project_name,expression:"project_name"}],staticClass:"form-control mx-2",attrs:{id:"project_name",type:"text"},domProps:{value:e.project_name},on:{input:function(t){t.target.composing||(e.project_name=t.target.value)}}}),n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.global-variables-modal",modifiers:{"global-variables-modal":!0}}],staticClass:"btn mx-2",attrs:{variant:"primary"}},[e._v("Edit Global Variables")]),n("button",{staticClass:"btn btn-primary mx-2",on:{click:e.add_sheet}},[e._v("Add Sheet")]),e.database.sheets.length?n("a",{staticClass:"btn btn-primary mx-2",attrs:{href:"#",download:e.project_name+".db.json"},on:{click:function(t){return t.preventDefault(),e.download_json_file_data(t)}}},[e._v(" Save JSON ")]):e._e()],1),n("div",{staticClass:"container-fluid"},[n("ul",{staticClass:"nav nav-tabs sticky-top"},e._l(e.database.sheets,(function(t){return n("li",{key:t._id,staticClass:"nav-item"},[n("a",{class:["nav-link","active",{selected:e.current_sheet_id===t._id}],on:{click:function(n){return e.change_sheet(t._id)}}},[n("div",{staticClass:"marker",style:"background-color:"+t.hex_color}),e._v(" "+e._s(t.name)+" ")])])})),0),e._l(e.database.sheets,(function(t){return n("div",{key:t._id},[e.current_sheet_id===t._id?n("Sheet",{attrs:{sheet:t,database:e.database,current_focus:e.current_focus},on:{"focus-sheet-and-record":e.focus_sheet_and_record}}):e._e()],1)})),e.database.sheets.length?e._e():n("div",{class:{hover:e.upload_highlighted},attrs:{id:"file-upload"},on:{drop:function(t){return t.preventDefault(),e.upload(t)},dragover:function(t){return t.preventDefault(),e.highlight_upload(t)},dragleave:function(t){return t.preventDefault(),e.unhighlight_upload(t)}}},[e._v(" Drag here to upload file ")]),n("hr"),n("button",{staticClass:"btn btn-primary toggle-json-btn",on:{click:e.toggle_json}},[e._v("Toggle JSON")]),e.show_json?n("pre",{staticClass:"json-output"},[e._v(e._s(e.json()))]):e._e(),n("b-modal",{attrs:{id:"global-variables-modal",title:"Global Variables"}},[n("VariableEditor",{attrs:{variables:e.database.global_variables},on:{update:e.update_global_variables,delete:e.delete_global_variables_key}})],1)],2)])},a=[]},"36a6":function(e,t,n){"use strict";n.r(t);var i=n("c313"),a=n("0452");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("76ee");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"07ece9b7",null);t["default"]=s.exports},"386a":function(e,t,n){"use strict";n.r(t);var i=n("46d8"),a=n("0e4e");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"ff1f2c00",null);t["default"]=s.exports},"38df":function(e,t,n){"use strict";n.r(t);var i=n("001e"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"39aa":function(e,t,n){"use strict";n.r(t);var i=n("0d8c"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"3c72":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",[e._v("Smallest value: "+e._s(e.min_min))]),n("div",[e._v("Biggest value: "+e._s(e.max_max))]),n("div",{staticClass:"input-group mb-3"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.min,expression:"min"}],staticClass:"form-control",attrs:{type:"number",min:e.min_min,max:e.max},domProps:{value:e.min},on:{input:function(t){t.target.composing||(e.min=t.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.max,expression:"max"}],staticClass:"form-control",attrs:{type:"number",min:e.min,max:e.max_max},domProps:{value:e.max},on:{input:function(t){t.target.composing||(e.max=t.target.value)}}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.reset}},[e._v("Reset")])])])])},a=[]},"3dfd":function(e,t,n){"use strict";n.r(t);var i=n("2fa3"),a=n("6f68");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("5c0b");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,null,null);t["default"]=s.exports},"3f84":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"input-group"},[n("input",{ref:"the_input",staticClass:"form-control",domProps:{value:e.value},on:{input:e.update_value}})])},a=[]},4036:function(e,t,n){"use strict";n.r(t);var i=n("8e5e"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},4338:function(e,t,n){"use strict";n.r(t);var i=n("b80f"),a=n("cf70");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("4d5b");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"686dbd38",null);t["default"]=s.exports},4514:function(e,t,n){},"46b6":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importStar(n("a4c9")),o=i.__importDefault(n("0405")),s=i.__importDefault(n("386a")),u=i.__importDefault(n("4338")),d=i.__importDefault(n("094d"));t.default=a.default.extend({name:"DefinitionFilter",components:{Integer:o.default,References:s.default,SelectOne:u.default,Stringy:d.default},data:function(){return{currently_filtering:!1}},props:{definition:Object,database:r.Database,values:Array},computed:{modal_dom_id:function(){return"definition-filter-modal-".concat(this.definition._id)}},methods:{handle_input:function(e,t){this.currently_filtering=null!=t,this.$emit("input",e,t)}}})},"46d1":function(e,t,n){"use strict";n.r(t);var i=n("0ad2"),a=n("1593");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("8294");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"1d3184d4",null);t["default"]=s.exports},"46d8":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" "+e._s(e.values.length)+" references used "),n("References",{attrs:{database:e.database},on:{input:e.emit_input},model:{value:e.currently_filtered_records,callback:function(t){e.currently_filtered_records=t},expression:"currently_filtered_records"}})],1)},a=[]},"4d5b":function(e,t,n){"use strict";var i=n("68f7"),a=n.n(i);a.a},"4ff5":function(e,t,n){"use strict";n.r(t);var i=n("0e82"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},5361:function(e,t,n){"use strict";var i=n("93e3"),a=n.n(i);a.a},"5c0b":function(e,t,n){"use strict";var i=n("9c0c"),a=n.n(i);a.a},"5f04":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importStar(n("a4c9"));t.default=a.default.extend({name:"Sheet",props:{record:Object,database:r.Database,definition_name:{type:String,require:!1,default:null}}})},"64ca":function(e,t,n){},"689f":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"record-result"},e._l(e.record.description_data(),(function(t,i){return n("span",{key:i,staticClass:"property",on:{click:function(t){return t.preventDefault(),e.$emit("focus-sheet-and-record",e.record.sheet._id,e.record._id)}}},[n("span",{staticClass:"key"},[e._v(e._s(i))]),n("span",{staticClass:"value"},[e._v(e._s(t))])])})),0)},a=[]},"68f7":function(e,t,n){},"6d8c":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"form-group"},[n("input",{ref:"the_input",staticClass:"form-control",domProps:{value:e.value&&e.value.expression_string},on:{input:e.update_value_event}})]),n("div",{staticClass:"form-group"},[n("span",{staticClass:"calculated-value"},[e._v(e._s(e.value&&e.value.calculated_value))]),n("span",{staticClass:"error"},[e._v(e._s(e.error))])])])},a=[]},"6de4":function(e,t,n){"use strict";n.r(t);var i=n("10ed"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"6f68":function(e,t,n){"use strict";n.r(t);var i=n("78c7"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},"74fb":function(e,t,n){"use strict";n.r(t);var i=n("b6c5"),a=n("7b9e");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("ad98");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"01f97d28",null);t["default"]=s.exports},"76ee":function(e,t,n){"use strict";var i=n("d1ea"),a=n.n(i);a.a},"78c7":function(e,t,n){"use strict";n("d3b7"),n("3ca3"),n("ddb0"),n("2b3d"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("5f5b")),o=i.__importDefault(n("3459")),s=i.__importDefault(n("fceb")),u=i.__importDefault(n("cbe0"));a.default.use(r.default),a.default.use(o.default,"v-icon");var d=i.__importStar(n("a4c9"));t.default=a.default.extend({name:"app",components:{VariableEditor:u.default,Sheet:s.default},data:function(){var e=new d.Database({});return{database:e,current_sheet_id:null,current_focus:null,project_name:"Project Name",upload_highlighted:!1,show_json:!1}},methods:{update_global_variables:function(e,t){a.default.set(this.database.global_variables,e,t)},delete_global_variables_key:function(e){a.default.delete(this.database.global_variables,e)},upload:function(e){var t=this;this.upload_highlighted=!1,e.dataTransfer.files.length>1&&alert("You cannot upload more than one file");var n=e.dataTransfer.files[0],i=(e.dataTransfer.items[0],new FileReader);i.onload=function(e){t.database=d.Database.from_saved(JSON.parse(e.target.result)),t.current_sheet_id=t.database.sheets[0]._id},i.readAsText(n)},highlight_upload:function(){this.upload_highlighted=!0},unhighlight_upload:function(){this.upload_highlighted=!1},add_sheet:function(){var e=this.database.sheets.length+1,t=new d.Sheet(this.database,"Sheet #".concat(e),null,null,[],null,!0,[]);this.current_sheet_id=t._id},change_sheet:function(e){this.current_sheet_id=e},focus_sheet_and_record:function(e,t){this.current_focus={sheet_id:e,record_id:t},this.current_sheet_id=e,window.setTimeout((function(){var e=document.getElementById("record-".concat(t));e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),1)},json:function(){return JSON.stringify(this.database.json_data(),null,2)},json_file_data_url:function(){var e=new Blob([this.json()],{type:"application/json"});return URL.createObjectURL(e)},download_json_file_data:function(){var e=new Blob([this.json()],{type:"application/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=this.project_name+".db.json",t.click(),URL.revokeObjectURL(t.href)},toggle_json:function(){this.show_json=!this.show_json}},computed:{}})},"7b9e":function(e,t,n){"use strict";n.r(t);var i=n("fb57"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},8030:function(e,t,n){"use strict";n("4de4"),n("caad"),n("d3b7"),n("2532"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("2ef0"));t.default=a.default.extend({name:"SelectOne",props:["definition","database","values"],data:function(){return{items:r.default(this.values).uniq().sort().value()}},watch:{items:{handler:function(e,t){var n=this;this.items.length===this.choices().length?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(e){return r.default.filter(e,(function(e){return n.items.includes(e.value_for_definition(n.definition))}))}))},deep:!0}},methods:{choices:function(){return r.default(this.values).uniq().sort().value()},select_none:function(){this.items=[]},select_all:function(){this.items=this.choices()}}})},8294:function(e,t,n){"use strict";var i=n("64ca"),a=n.n(i);a.a},"882e":function(e,t,n){"use strict";n("b0c0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("2ef0")),o=i.__importStar(n("a4c9"));t.default=a.default.extend({name:"DefinitionDetails",data:function(){return{option_to_add:null,old_value:null,new_value:null}},props:{value:Object,sub_definition:Boolean,database:o.Database},computed:{definition:function(){return this.value},options:function(){return this.value.options||[]}},methods:{add_option:function(){var e=this.options;e.push(this.option_to_add),this.value.options=r.default.uniq(e),this.option_to_add=null},remove_option:function(e,t){confirm("Do you really want to remove the option `".concat(e,"`?"))&&(this.value.options=r.default.reject(this.options,(function(t){return t==e})))},emit_remove:function(){confirm("Do you really want to delete the definition ".concat(this.definition.name,"?"))&&this.$emit("remove",this.definition)},remove:function(e,t){this.$emit("remove-sub-definition",this.value,e)},add_definition:function(){var e=r.default.cloneDeep(this.value),t=new o.Definition({name:"Def #1",type:"string"});null==e.definitions&&(e.definitions=[]),e.definitions.push(t),this.$emit("input",e)}}})},"8c5b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e"));t.default=a.default.extend({name:"SelectOne",data:function(){return{}},props:{value:String,definition:Object},methods:{update_value:function(e){this.$emit("input",e.target.value)}}})},"8d65":function(e,t,n){"use strict";n.r(t);var i=n("689f"),a=n("0538");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("ffa0");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"110ca0a2",null);t["default"]=s.exports},"8d66":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group referenced-records"},[e._l(e.grouped_references(),(function(t){return n("div",{key:t.sheet._id,class:{sheet:!0,valid:e.valid_sheet(t.sheet)}},[n("span",{staticClass:"sheet-name",style:"background-color:"+t.sheet.hex_color},[e._v(" "+e._s(t.sheet.name)+" ")]),e._l(t.references,(function(t){return n("div",{key:t.record._id,staticClass:"referenced-record"},[e.changable?n("a",{staticClass:"remove",on:{click:function(n){return n.stopPropagation(),e.remove(t.record)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1):e._e(),e.changable?n("a",{staticClass:"remove",on:{click:function(n){return n.stopPropagation(),e.edit_properties(t)}}},[n("v-icon",{attrs:{name:"edit"}})],1):e._e(),n("RecordResult",{attrs:{record:t.record,database:e.database},on:{"focus-sheet-and-record":e.focus_sheet_and_record}})],1)}))],2)})),e.changable?n("div",{staticClass:"search"},[n("b-input-group",{attrs:{prepend:"🔎"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.match_text,expression:"match_text"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.match_text},on:{input:function(t){t.target.composing||(e.match_text=t.target.value)}}})]),e.match_text?n("div",{staticClass:"results"},[n("b-list-group",e._l(e.search_results(),(function(t){return n("b-list-group-item",{key:t._id,staticClass:"search_result",attrs:{button:"",variant:"secondary"},on:{click:function(n){return n.target!==n.currentTarget?null:e.choose(t,n)}}},[n("div",{staticClass:"record-result"},[n("span",{staticClass:"sheet-name",style:"background-color:"+t.sheet.hex_color},[e._v(" "+e._s(t.sheet.name)+" ")]),e._v(" » "),e._l(t.description_data(),(function(i,a){return n("span",{key:a,staticClass:"property",on:{click:function(n){return n.target!==n.currentTarget?null:e.$emit("focus-sheet-and-record",t.sheet._id,t._id)}}},[n("span",{staticClass:"value"},[e._v(e._s(i))])])}))],2)])})),1)],1):e._e()],1):e._e(),e.currently_edited_reference?n("div",[n("b-modal",{attrs:{"ok-only":"",id:e.references_definition_edit_modal_id,title:"Edit reference properties"}},e._l(e.definition_definitions,(function(t){return n("div",{key:t._id},[e._v(" "+e._s(t.name)+" "),n("Field",{attrs:{record:e.currently_edited_reference,definition:t,database:e.database}})],1)})),0)],1):e._e()],2)},a=[]},"8e5e":function(e,t,n){"use strict";n("caad"),n("d81d"),n("d3b7"),n("07ac"),n("ac1f"),n("6062"),n("2532"),n("3ca3"),n("841c"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("8d65")),o=i.__importDefault(n("2ef0")),s=i.__importStar(n("a4c9"));t.default=a.default.extend({name:"References",components:{RecordResult:r.default,Field:function(){return Promise.resolve().then((function(){return i.__importStar(n("c08e"))}))}},data:function(){return{match_text:null,currently_edited_reference:null}},props:{value:Array,record_id:String,definition_definitions:Array,definition:s.ReferencesDefinition,database:Object,changable:{type:Boolean,required:!1,default:!0}},computed:{references_definition_edit_modal_id:function(){return"references-definitions-edit-modal-"+this.record_id+this.definition._id},definition_referenceable_sheet_ids_set:function(){return this.definition?new Set(this.definition.referenceable_sheet_ids):new Set}},methods:{search_results:function(){var e=this;if(!this.match_text)return[];var t=o.default.map(this.value,"record._id");return o.default(this.database.search("".concat(this.match_text),this.definition_referenceable_sheet_ids_set)).reject((function(n){return n._id===e.record_id||t.includes(n._id)})).take(7).value()},grouped_references:function(){var e=o.default.groupBy(this.value,"record.sheet._id");return o.default(Object.values(e)).sortBy((function(e){return e[0].record.sheet._id})).map((function(e){var t=e[0].record.sheet;return{references:o.default.uniq(e),sheet:t}})).value()},choose:function(e,t){var n=this.value||[];this.$emit("input",o.default.set(n,n.length,new s.Reference(e,{}))),this.match_text=null},remove:function(e){this.$emit("input",o.default.reject(this.value,(function(t){return t.record._id==e._id})))},focus_sheet_and_record:function(e,t){this.$emit("focus-sheet-and-record",e,t)},edit_properties:function(e){this.$bvModal.show(this.references_definition_edit_modal_id),a.default.set(this,"currently_edited_reference",e)},valid_sheet:function(e){return!this.definition||(0==this.definition_referenceable_sheet_ids_set.size||this.definition_referenceable_sheet_ids_set.has(e._id))}}})},"90d7":function(e,t,n){},9177:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("08c6")),o=i.__importDefault(n("74fb")),s=i.__importDefault(n("df79")),u=i.__importDefault(n("9f79")),d=i.__importDefault(n("bd5b")),l=i.__importDefault(n("c2ae")),c=i.__importStar(n("a4c9"));t.default=a.default.extend({name:"Field",components:{Expression:r.default,Integer:o.default,References:s.default,SelectOne:u.default,String:d.default,TextArea:l.default},props:{record:Object,definition:Object,database:c.Database},data:function(){return{recompute:0}},computed:{record_value:function(){this.recompute;return this.record.value_for_definition(this.definition)}},methods:{focus_sheet_and_record:function(e,t){this.$emit("focus-sheet-and-record",e,t)},update_value:function(e){this.recompute=this.recompute+1,this.record.update_value(this.definition,e)}}})},"93e3":function(e,t,n){},9862:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e"));t.default=a.default.extend({name:"VariableEditor",data:function(){return{new_key:null}},props:{variables:Object},methods:{add_variable:function(){this.new_key&&(this.$emit("update",this.new_key,"123"),this.new_key=null)},update_variable:function(e,t){this.$emit("update",e,t.target.value)},delete_variable:function(e){this.$emit("delete",e)}}})},"993c":function(e,t,n){},"9c0c":function(e,t,n){},"9dd3":function(e,t,n){},"9f79":function(e,t,n){"use strict";n.r(t);var i=n("2cf1"),a=n("1250");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("c5e8");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"037c2dcb",null);t["default"]=s.exports},a4c9:function(e,t,n){"use strict";n("99af"),n("4de4"),n("7db0"),n("c740"),n("5db7"),n("4160"),n("caad"),n("d81d"),n("13d5"),n("73d9"),n("b0c0"),n("d3b7"),n("ac1f"),n("2532"),n("841c"),n("159b"),n("ddb0");var i=n("5bc3"),a=n("ed6d"),r=n("2d0d"),o=n("970b");Object.defineProperty(t,"__esModule",{value:!0});var s=n("9ab4"),u=s.__importDefault(n("2ef0")),d=s.__importDefault(n("ffe7")),l=n("e144").v1,c=function e(t){o(this,e),this._id=t._id||l(),this.name=t.name,this.type=t.type,this.unique_id=t.unique_id,this.options=t.options};t.Definition=c;var f=function(e){a(n,e);var t=r(n);function n(e){var i;return o(this,n),i=t.call(this,e),i.definitions=e.definitions||[],i.referenceable_sheet_ids=e.referenceable_sheet_ids||[],i}return n}(c);t.ReferencesDefinition=f;var _=function(e){return e["_id"]?e:u.default.assign(e,{_id:l()})},v=function(e,t){return u.default.reduce(t,(function(t,n){return u.default.set(t,n.name,e[n._id])}),{})},h=function(e,t){return u.default.reduce(t,(function(t,n){return u.default.set(t,n._id,e[n.name])}),{})},p=function(){function e(t){o(this,e),this.data=t}return i(e,[{key:"value_for_definition",value:function(e){return this.data[e._id]}},{key:"update_value",value:function(e,t){u.default.set(this.data,e._id,t)}},{key:"empty",value:function(){}}]),e}();t.DataObject=p;var m=function(e){a(n,e);var t=r(n);function n(e,i){var a;return o(this,n),a=t.call(this,e),a.data=u.default(e).mapKeys((function(e,t){return"_"===t[0]?t:i.definitions_by_name[t]._id})).tap(_).value(),a.sheet=i,a}return i(n,[{key:"values",value:function(){var e=this;return u.default.mapKeys(this.data,(function(t,n){return"_"===n[0]?n:e.sheet.definitions_by_id[n].name}))}},{key:"delete_definition",value:function(e){u.default.set(this,"data",u.default.omit(this.data,e._id))}},{key:"delete_sub_definition",value:function(e,t){this.transform_value(e,(function(e){return u.default.map(e,(function(e){return u.default.set(e,"data",u.default.omit(e.data,t._id))}))}))}},{key:"transform_value",value:function(e,t){this.data[e._id]=t(this.data[e._id])}},{key:"description_data",value:function(){var e=this.sheet.unique_id_field(),t={};return t[e]=this.values()[e],t}},{key:"_id",get:function(){return this.data._id}}]),n}(p);t.Record=m;var b=function(e){a(n,e);var t=r(n);function n(e,i){var a;return o(this,n),a=t.call(this,i),a.record=e,a}return n}(p);t.Reference=b;var y=function(){function e(t,n,i,a,r,s,d,_){var v=this;o(this,e),this.database=t,this.database.add_sheet(this),this._id=i||l(),this.name=n,this.definitions=u.default.map(r,(function(e){return"references"==e.type?new f(e):new c(e)})),this.update_definition_caches(),this.definition_ids_to_display=s||u.default.map(r,"_id"),this.display_referencers=null==d||d,e.last_used_hex_color=e.last_used_hex_color+1,this.hex_color=a||e.hex_colors[e.last_used_hex_color],this.records_data=[],this.records=u.default.map(_,(function(e){return new m(e,v)}))}return i(e,[{key:"schema",value:function(){return this.definitions}},{key:"find_by_id",value:function(e){return u.default.find(this?this.records_data:[],{_id:e})}},{key:"add_definition",value:function(){var e=this.definitions.length+1,t=_({name:"Column #".concat(e),type:"string"});this.definitions.push(t),this.update_definition_caches(),this.definition_ids_to_display.push(t._id)}},{key:"update_definition_caches",value:function(){this.definitions_by_id=u.default.keyBy(this.definitions,"_id"),this.definitions_by_name=u.default.keyBy(this.definitions,"name")}},{key:"add_row",value:function(e){"top"==e?this.records.unshift(new m({},this)):this.records.push(new m({},this))}},{key:"remove_row",value:function(e){this.records=u.default.reject(this.records,(function(t){return t._id===e}))}},{key:"translate_record",value:function(e){var t=u.default.keyBy(this.definitions,"_id");return u.default.mapKeys(e,(function(e,n){return"_"===n[0]?n:t[n].name}))}},{key:"record_values",value:function(e){var t=this.unique_id_field(),n={};return n[t]=e[t],n}},{key:"unique_id_field",value:function(){var e=u.default(this.definitions).find({unique_id:!0});return e?e.name:"_id"}},{key:"json_data",value:function(){return{_id:this._id,name:this.name,hex_color:this.hex_color,definitions:this.definitions,definition_ids_to_display:this.definition_ids_to_display,display_referencers:this.display_referencers}}},{key:"delete_definition",value:function(e){var t=this.find_definition(e);u.default.each(this.records,(function(e){e.delete_definition(t)})),u.default.pull(this.definition_ids_to_display,t._id),u.default.pull(this.definitions,t)}},{key:"delete_sub_definition",value:function(e,t){u.default.each(this.records,(function(n){n.delete_sub_definition(e,t)})),u.default.set(e,"definitions",u.default.without(e.definitions,t))}},{key:"find_definition",value:function(e){var t=u.default.find(this.definitions,{_id:e});if(!t)throw"Unable to find definition: ".concat(e);return t}},{key:"replace_definition",value:function(e,t){var n=u.default.findIndex(this.definitions,{_id:e});this.definitions[n]=t}},{key:"transform_values",value:function(e,t,n){return this.records_data=this.records_data.map((function(i){return i[e]===t?u.default.set(i,e,n):i}))}}]),e}();y.hex_colors=["#D11141","#00B159","#00AEDB","#F37735","#FFC425"],y.last_used_hex_color=-1,t.Sheet=y;var g=function(){function e(t){o(this,e),this.description_types=["string","text_area","select_one"],this.sheets=[],this.global_variables=t}return i(e,[{key:"finalize_load",value:function(){u.default.each(this.sheets,(function(e){u.default.each(e.records,(function(t){var n=u.default.filter(e.definitions,{type:"references"});u.default.each(n,(function(n){t.transform_value(n,(function(t){return u.default.compact(u.default.map(t||[],(function(t){var i=t.sheet_id,a=t.record_id,r=t.data,o=e.database.find_sheet(i);if(void 0==o)throw"Could not find sheet ID: ".concat(i);var s=u.default.find(o.records,{_id:a});return void 0==s?null:new b(s,h(r,n.definitions))})))}))}))}))}))}},{key:"add_sheet",value:function(e){this.sheets.push(e)}},{key:"search",value:function(e,t){var n=this,i=u.default(this.sheets).flatMap((function(e){return e.definitions})).filter((function(e){return n.description_types.includes(e.type)})).map((function(e){return"data.".concat(e._id)})).value(),a=this.sheets;t.size&&(a=u.default.filter(a,(function(e){return t.has(e._id)})));var r=u.default.flatMap(a,"records"),o=new d.default(r,{keys:i,threshold:.3});return o.search(e)}},{key:"fetch_record_reference",value:function(e){var t=u.default.find(this.sheets,(function(t){return t._id===e.sheet_id}));if(!t)return null;var n=t.find_by_id(e.record_id);return n?{sheet:t,id:e.record_id,record:t.translate_record(n)}:null}},{key:"find_sheet",value:function(e){return u.default.find(this.sheets,{_id:e})}},{key:"referencer_references",value:function(){return u.default.reduce(this.sheets,(function(e,t){var n=u.default.filter(t.definitions,{type:"references"});return t.records.forEach((function(t){n.forEach((function(n){(t.value_for_definition(n)||[]).forEach((function(i){var a="".concat(i.record.sheet._id,"|").concat(i.record._id);e[a]||(e[a]={}),e[a][n._id]||(e[a][n._id]=[]),e[a][n._id].push(new b(t,{}))}))}))})),e}),{})}},{key:"json_data_bak",value:function(){var e=this,t=u.default.reduce(this.sheets,(function(e,t){return e[t.name]=t.json_data(),e}),{}),n=u.default.reduce(this.sheets,(function(e,t){return u.default.set(e,t._id,u.default.find(t.definitions,{unique_id:!0}))}),{}),i=u.default.reduce(this.sheets,(function(t,i){var a=u.default.filter(i.definitions,(function(e){return"references"==e.type}));return t[i.name]=u.default.map(i.records,(function(t){return u.default.reduce(a,(function(t,i){var a=t[i.name];return a&&a.length&&(t[i.name]=u.default.map(a,(function(t){var i=e.fetch_record_reference(t);if(i){t=u.default.set(t,"sheet_name",i.sheet.name);var a=n[i.sheet._id];return a&&(t=u.default.set(t,a.name,i.record[a.name])),t}return t}))),t}),t.values())})),t}),{});return{global_variables:this.global_variables,sheets:t,records:i}}},{key:"json_data",value:function(){var e=u.default.reduce(this.sheets,(function(e,t){return e[t.name]=t.json_data(),e}),{}),t=u.default.reduce(this.sheets,(function(e,t){return u.default.set(e,t._id,u.default.find(t.definitions,{unique_id:!0}))}),{}),n=u.default.reduce(this.sheets,(function(e,n){var i=u.default.filter(n.definitions,(function(e){return"references"==e.type}));return e[n.name]=u.default.map(n.records,(function(e){return u.default.reduce(i,(function(e,n){var i=e[n.name];return i&&i.length&&(e[n.name]=u.default.map(i,(function(e){var i=e.record,a=v(e.data,n.definitions),r={record_id:i._id,sheet_id:i.sheet._id,sheet_name:i.sheet.name,data:a},o=t[i.sheet._id];return o&&(r=u.default.set(r,o.name,i.value_for_definition(o))),r}))),e}),e.values())})),e}),{});return{global_variables:this.global_variables,sheets:e,records:n}}}],[{key:"from_saved",value:function(t){var n=new e(t.global_variables||{});u.default.map(t.sheets,(function(e){return new y(n,e.name,e._id,e.hex_color,e.definitions,e.definition_ids_to_display,e.display_referencers,t.records[e.name])}));return n.finalize_load(),n}}]),e}();t.Database=g},a6bb:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",{staticClass:"input-group mb-3"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search_query,expression:"search_query"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.search_query},on:{input:function(t){t.target.composing||(e.search_query=t.target.value)}}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.clear}},[e._v("Clear")])])])])},a=[]},a855:function(e,t,n){"use strict";n("99af"),n("c740"),n("5db7"),n("13d5"),n("73d9"),n("d3b7"),n("07ac"),n("6062"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("d6dc")),o=i.__importDefault(n("36a6")),s=i.__importDefault(n("df79")),u=i.__importDefault(n("c08e")),d=n("c345"),l=i.__importDefault(n("310e")),c=i.__importStar(n("a4c9")),f=i.__importDefault(n("2ef0"));t.default=a.default.extend({name:"Sheet",components:{Definition:r.default,DefinitionFilter:o.default,References:s.default,Field:u.default,ChromePicker:d.Chrome,draggable:l.default},data:function(){return{colors:{hex:this.sheet.hex_color},filters:{},currently_edited_record:new c.Record({},this.sheet)}},props:{sheet:c.Sheet,database:c.Database,current_focus:Object},computed:{records_to_display:function(){return f.default(this.filters).values().compact().reduce((function(e,t){return t(e)}),this.sheet.records)},total_count:function(){return this.sheet.records.length},filter_has_limited_rows:function(){return this.records_to_display.length!==this.total_count},database_referencer_references:function(){return this.database.referencer_references()},sheet_definition_ids_to_display_set:function(){return new Set(this.sheet.definition_ids_to_display)}},methods:{should_display_definition:function(e){return this.sheet_definition_ids_to_display_set.has(e._id)},update_color:function(e){this.sheet.hex_color=e.hex},record_focused:function(e){return!!this.current_focus&&e._id===this.current_focus.record_id},remove_row:function(e){confirm("Do you really want to delete this row?")&&this.sheet.remove_row(e)},remove_definition:function(e){this.sheet.delete_definition(e._id)},remove_sub_definition:function(e,t){this.sheet.delete_sub_definition(e,t)},focus_sheet_and_record:function(e,t,n){this.$emit("focus-sheet-and-record",e,t),n.stopPropagation()},referencer_references_for:function(e,t){var n="".concat(e._id,"|").concat(t._id);return f.default.flatten(Object.values(this.database_referencer_references[n]||{}))},set_filter:function(e,t){a.default.set(this.filters,e,t)},values_for:function(e){return f.default(this.sheet.records).flatMap((function(t){return t.value_for_definition(e)})).compact().value()},sortable:function(e){return"references"!==e.type},sort:function(e,t){var n=f.default(this.sheet.records_data).sortBy(e._id);"desc"===t&&(n=n.reverse()),this.sheet.records_data=n.value()},transform_values:function(e,t,n){this.sheet.transform_values(e._id,t,n)},replace_definition:function(e,t){var n=f.default.findIndex(this.sheet.definitions,{_id:e});a.default.set(this.sheet.definitions,n,t)},edit_record:function(e){this.currently_edited_record=e,this.$bvModal.show("edit-record-modal")}}})},ad98:function(e,t,n){"use strict";var i=n("4514"),a=n.n(i);a.a},b145:function(e,t,n){"use strict";var i=n("993c"),a=n.n(i);a.a},b19a:function(e,t,n){"use strict";n("4de4"),n("d81d"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("df79")),o=i.__importStar(n("a4c9")),s=i.__importDefault(n("2ef0"));t.default=a.default.extend({name:"DefinitionFilter",props:{definition:Object,database:o.Database,values:Array},components:{References:r.default},data:function(){return{match_text:null,currently_filtered_records:[]}},methods:{emit_input:function(e){this.currently_filtered_records=e;var t=s.default.map(this.currently_filtered_records,"_id"),n=this.definition;0===t.length?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(e){return s.default.filter(e,(function(e){var i=s.default.map(e.value_for_definition(n)||[],"record._id");return s.default.intersection(t,i).length>0}))}))}}})},b4aa:function(e,t,n){},b6c5:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"input-group"},[n("input",{ref:"the_input",staticClass:"form-control",attrs:{type:"number"},domProps:{value:e.value},on:{input:e.update_value}})])},a=[]},b80f:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",{staticClass:"form-check"},[e._l(e.choices(),(function(t){return n("label",{key:t,staticClass:"form-check-label"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.items,expression:"items"}],staticClass:"form-check-input",attrs:{type:"checkbox"},domProps:{value:t,checked:Array.isArray(e.items)?e._i(e.items,t)>-1:e.items},on:{change:function(n){var i=e.items,a=n.target,r=!!a.checked;if(Array.isArray(i)){var o=t,s=e._i(i,o);a.checked?s<0&&(e.items=i.concat([o])):s>-1&&(e.items=i.slice(0,s).concat(i.slice(s+1)))}else e.items=r}}}),e._v(" "+e._s(t)+" ")])})),e._v(" Select: "),n("div",{staticClass:"btn-group",attrs:{role:"group","aria-label":"Basic example"}},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.select_none}},[e._v("None")]),n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.select_all}},[e._v("All")])])],2)])},a=[]},bd5b:function(e,t,n){"use strict";n.r(t);var i=n("3f84"),a=n("0cf2");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"7417dfed",null);t["default"]=s.exports},c08e:function(e,t,n){"use strict";n.r(t);var i=n("d53a"),a=n("13c1");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"1eca68ca",null);t["default"]=s.exports},c2ae:function(e,t,n){"use strict";n.r(t);var i=n("0e4e2"),a=n("39aa");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"ac35ae54",null);t["default"]=s.exports},c313:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("v-icon",{directives:[{name:"b-modal",rawName:"v-b-modal",value:e.modal_dom_id,expression:"modal_dom_id"}],class:{notice:e.currently_filtering},attrs:{name:"filter"}}),n("b-modal",{attrs:{"ok-only":"",id:e.modal_dom_id,static:!0,title:"Filter "+e.definition.name}},["references"===e.definition.type?n("References",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e(),"select_one"===e.definition.type?n("SelectOne",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e(),["string","text_area"].includes(e.definition.type)?n("Stringy",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e(),"integer"===e.definition.type?n("Integer",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e()],1)],1)},a=[]},c5e8:function(e,t,n){"use strict";var i=n("9dd3"),a=n.n(i);a.a},cb02:function(e,t,n){"use strict";n.r(t);var i=n("ef99"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},cbe0:function(e,t,n){"use strict";n.r(t);var i=n("089a"),a=n("d4f3");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"36802e6b",null);t["default"]=s.exports},cd49:function(e,t,n){"use strict";n("e623"),n("e379"),n("5dc8"),n("37e1"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("3dfd"));a.default.config.productionTip=!1,new a.default({render:function(e){return e(r.default)}}).$mount("#app")},cf70:function(e,t,n){"use strict";n.r(t);var i=n("8030"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},d1ea:function(e,t,n){},d4f3:function(e,t,n){"use strict";n.r(t);var i=n("9862"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},d53a:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",["string"===e.definition.type?n("String",{attrs:{value:e.record_value},on:{input:e.update_value}}):e._e(),"text_area"===e.definition.type?n("TextArea",{attrs:{value:e.record_value},on:{input:e.update_value}}):e._e(),e._v(" "),"integer"===e.definition.type?n("Integer",{attrs:{value:e.record_value},on:{input:e.update_value}}):e._e(),"select_one"===e.definition.type?n("SelectOne",{attrs:{value:e.record_value,definition:e.definition},on:{input:e.update_value}}):e._e(),"references"===e.definition.type?n("References",{attrs:{value:e.record_value||[],record_id:e.record._id,definition:e.definition,definition_definitions:e.definition.definitions,database:e.database},on:{"focus-sheet-and-record":e.focus_sheet_and_record,input:e.update_value}}):e._e(),"expression"===e.definition.type?n("Expression",{attrs:{value:e.record_value,definition:e.definition,global_variables:e.database.global_variables},on:{input:e.update_value}}):e._e()],1)},a=[]},d6dc:function(e,t,n){"use strict";n.r(t);var i=n("09d4"),a=n("38df");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"c3782dd4",null);t["default"]=s.exports},df79:function(e,t,n){"use strict";n.r(t);var i=n("8d66"),a=n("4036");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("b145");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"64872fba",null);t["default"]=s.exports},e4a9:function(e,t,n){"use strict";n.r(t);var i=n("a855"),a=n.n(i);for(var r in i)"default"!==r&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t["default"]=a.a},ef90:function(e,t,n){"use strict";var i=n("b4aa"),a=n.n(i);a.a},ef99:function(e,t,n){"use strict";n("ac1f"),n("841c"),n("498a"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e")),r=i.__importDefault(n("2ef0")),o=i.__importDefault(n("ffe7"));t.default=a.default.extend({name:"Stringy",props:["definition","database","values"],data:function(){return{search_query:""}},watch:{search_query:{handler:function(e,t){var n=this;""===r.default.trim(this.search_query)?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(e){var t=new o.default(e,{shouldSort:!1,keys:["data.".concat(n.definition._id)],threshold:.2});return t.search(n.search_query)}))}}},methods:{clear:function(){this.search_query=""}}})},f9d6:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"sheet-modal-"+e.sheet._id,expression:"'sheet-modal-' + sheet._id"}],staticClass:"btn btn-primary"},[e._v("Edit Sheet")]),n("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.sheet.add_definition()}}},[e._v("Add Column")]),n("button",{staticClass:"btn btn-primary add-row-btn",on:{click:function(t){return e.sheet.add_row("top")}}},[e._v("Add Row")]),n("table",{staticClass:"table table-striped table-bordered"},[n("thead",{staticClass:"thead-light"},[n("tr",[n("th",{attrs:{colspan:"100%"}},[n("h4",[e._v(" "+e._s(e.total_count)+" total rows "),n("span",{class:{"filter-display":!0,"filter-has-limited-rows":e.filter_has_limited_rows}},[e._v(" (filtered to "+e._s(e.records_to_display.length)+" record(s)) ")])])])]),n("tr",{staticClass:"columns-to-display"},[n("th",{attrs:{colspan:"100%"}},[n("h3",[e._v("Columns to Display")]),e._l(e.sheet.definitions,(function(t){return n("div",{key:t._id,staticClass:"form-check form-check-inline"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.sheet.definition_ids_to_display,expression:"sheet.definition_ids_to_display"}],staticClass:"form-check-input",attrs:{type:"checkbox"},domProps:{value:t._id,checked:Array.isArray(e.sheet.definition_ids_to_display)?e._i(e.sheet.definition_ids_to_display,t._id)>-1:e.sheet.definition_ids_to_display},on:{change:function(n){var i=e.sheet.definition_ids_to_display,a=n.target,r=!!a.checked;if(Array.isArray(i)){var o=t._id,s=e._i(i,o);a.checked?s<0&&e.$set(e.sheet,"definition_ids_to_display",i.concat([o])):s>-1&&e.$set(e.sheet,"definition_ids_to_display",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.sheet,"definition_ids_to_display",r)}}}),e._v(" "+e._s(t.name)+" ")])])})),n("div",{staticClass:"form-check form-check-inline"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.sheet.display_referencers,expression:"sheet.display_referencers"}],staticClass:"form-check-input",attrs:{type:"checkbox"},domProps:{checked:Array.isArray(e.sheet.display_referencers)?e._i(e.sheet.display_referencers,null)>-1:e.sheet.display_referencers},on:{change:function(t){var n=e.sheet.display_referencers,i=t.target,a=!!i.checked;if(Array.isArray(n)){var r=null,o=e._i(n,r);i.checked?o<0&&e.$set(e.sheet,"display_referencers",n.concat([r])):o>-1&&e.$set(e.sheet,"display_referencers",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.sheet,"display_referencers",a)}}}),e._v(" Referencers ")])])],2)]),n("tr",{staticClass:"table-header"},[n("th"),e._l(e.sheet.definitions,(function(t){return[e.should_display_definition(t)?n("th",{key:t._id,staticClass:"field-cell"},[n("Definition",{attrs:{value:t,database:e.database},on:{input:function(n){return e.replace_definition(t._id,n)},remove:function(n){return e.remove_definition(t)},"remove-sub-definition":e.remove_sub_definition,"transform-values":e.transform_values}}),n("DefinitionFilter",{attrs:{definition:t,values:e.values_for(t),database:e.database},on:{input:e.set_filter}}),e.sortable(t)?n("span",[n("a",{on:{click:function(n){return e.sort(t,"desc")}}},[n("v-icon",{attrs:{name:"chevron-down"}})],1),n("a",{on:{click:function(n){return e.sort(t,"asc")}}},[n("v-icon",{attrs:{name:"chevron-up"}})],1)]):e._e()],1):e._e()]})),e.sheet.display_referencers?n("th",[e._v("Referencers")]):e._e(),n("th")],2)]),n("b-modal",{attrs:{"ok-only":"",size:"lg",id:"edit-record-modal","modal-class":"record-modal",title:"Edit Sheet"}},e._l(e.sheet.definitions,(function(t){return n("div",{key:t._id,staticClass:"form-inline"},[n("label",[n("strong",[e._v(e._s(t.name))]),n("Field",{attrs:{record:e.currently_edited_record,definition:t,database:e.database}})],1)])})),0),e._l(e.records_to_display,(function(t){return[n("tr",{key:t._id,class:{selected:e.record_focused(t)},attrs:{id:"record-"+t._id},on:{click:function(n){return e.focus_sheet_and_record(e.sheet._id,t._id,n)}}},[n("td",[n("b-button",{staticClass:"btn btn-primary",on:{click:function(n){return e.edit_record(t)}}},[e._v("Edit")])],1),e._l(e.sheet.definitions,(function(i){return[e.should_display_definition(i)?n("td",{key:i._id},[n("Field",{attrs:{record:t,definition:i,database:e.database},on:{"focus-sheet-and-record":e.focus_sheet_and_record}})],1):e._e()]})),e.sheet.display_referencers?n("td",[n("References",{attrs:{value:e.referencer_references_for(e.sheet,t),changable:!1,database:e.database},on:{"focus-sheet-and-record":e.focus_sheet_and_record}})],1):e._e(),n("td",[n("a",{staticClass:"remove",on:{click:function(n){return e.remove_row(t._id)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1)])],2)]}))],2),n("button",{staticClass:"btn btn-primary add-row-btn",on:{click:function(t){return e.sheet.add_row("bottom")}}},[e._v("Add Row")]),n("b-modal",{attrs:{"ok-only":"",id:"sheet-modal-"+e.sheet._id,title:"Edit Sheet"}},[n("div",{staticClass:"form-group"},[n("label",[e._v(" Name "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.sheet.name,expression:"sheet.name"}],staticClass:"form-control",domProps:{value:e.sheet.name},on:{input:function(t){t.target.composing||e.$set(e.sheet,"name",t.target.value)}}})])]),n("div",{staticClass:"form-group"},[n("label",[e._v(" Color "),n("ChromePicker",{attrs:{value:e.colors},on:{input:e.update_color}})],1)]),n("h1",[e._v("Column order")]),n("h2",[e._v("(drag to reorder)")]),n("draggable",{attrs:{tag:"ul"},model:{value:e.sheet.definitions,callback:function(t){e.$set(e.sheet,"definitions",t)},expression:"sheet.definitions"}},e._l(e.sheet.definitions,(function(t){return n("div",{key:t._id,staticClass:"list-group-item"},[e._v(" "+e._s(t.name)+" ")])})),0)],1)],1)},a=[]},fb57:function(e,t,n){"use strict";n("a9e3"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),a=i.__importDefault(n("2b0e"));t.default=a.default.extend({name:"Integer",props:{value:Number},methods:{update_value:function(e){this.$emit("input",parseInt(e.target.value))}}})},fceb:function(e,t,n){"use strict";n.r(t);var i=n("f9d6"),a=n("e4a9");for(var r in a)"default"!==r&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("ef90");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"2b256f90",null);t["default"]=s.exports},ffa0:function(e,t,n){"use strict";var i=n("90d7"),a=n.n(i);a.a}});
//# sourceMappingURL=app.0c686a4c.js.map