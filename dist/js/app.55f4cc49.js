(function(e){function t(t){for(var i,o,s=t[0],u=t[1],d=t[2],l=0,f=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&f.push(r[o][0]),r[o]=0;for(i in u)Object.prototype.hasOwnProperty.call(u,i)&&(e[i]=u[i]);c&&c(t);while(f.length)f.shift()();return a.push.apply(a,d||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],i=!0,s=1;s<n.length;s++){var u=n[s];0!==r[u]&&(i=!1)}i&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var i={},r={app:0},a=[];function o(t){if(i[t])return i[t].exports;var n=i[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=i,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(n,i,function(t){return e[t]}.bind(null,i));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/json-db/dist/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var d=0;d<s.length;d++)t(s[d]);var c=u;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"001e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("46d1")),o=i.__importStar(n("a4c9"));t.default=r.default.extend({name:"Definition",components:{DefinitionDetails:a.default},props:{value:Object,database:o.Database},watch:{value:function(e,t){this.$emit("input",e)}},data:function(){return{modal_dom_id:"edit-definition-modal-".concat(this.value._id)}},methods:{remove:function(e,t){this.$bvModal.hide(this.modal_dom_id),this.$emit("remove",e,t)},remove_sub_definition:function(e,t,n){this.$emit("remove-sub-definition",e,t,n)},update:function(e){this.$emit("input",e)}}})},"0538":function(e,t,n){"use strict";n.r(t);var i=n("5f04"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"0726":function(e,t,n){"use strict";n.r(t);var i=n("43f2"),r=n("36ae");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("7010");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"46772127",null);t["default"]=s.exports},"07a7":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"record-result"},e._l(e.record.description_data(),(function(t,i){return n("span",{key:i,staticClass:"property",on:{click:function(t){return t.preventDefault(),e.$emit("record-clicked",e.record)}}},[n("span",{staticClass:"key"},[e._v(e._s(i))]),n("span",{staticClass:"value"},[e._v(e._s(t))])])})),0)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"089a":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e._l(e.variables,(function(t,i){return n("div",{key:i,staticClass:"row"},[n("label",{staticClass:"col",attrs:{for:"input-"+i}},[e._v(" "+e._s(i)+" "),n("span",{on:{click:function(t){return e.delete_variable(i)}}},[n("v-icon",{attrs:{name:"x"}})],1)]),n("input",{staticClass:"col",attrs:{id:"input-"+i,type:"number"},domProps:{value:t},on:{input:function(t){return e.update_variable(i,t)}}})])})),n("input",{directives:[{name:"model",rawName:"v-model",value:e.new_key,expression:"new_key"}],attrs:{type:"text"},domProps:{value:e.new_key},on:{input:function(t){t.target.composing||(e.new_key=t.target.value)}}}),n("a",{on:{click:e.add_variable}},[e._v("Add")])],2)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"08c6":function(e,t,n){"use strict";n.r(t);var i=n("4d0e"),r=n("6de4");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("1aff");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"d9f846f8",null);t["default"]=s.exports},"09d4":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("b-modal",{ref:e.modal_dom_id,attrs:{"ok-only":"",id:e.modal_dom_id,title:"BootstrapVue"}},[n("DefinitionDetails",{attrs:{value:e.value,database:e.database},on:{input:e.update,remove:e.remove,"remove-sub-definition":e.remove_sub_definition}})],1),e._v(" "+e._s(e.value.name)+" "),n("br"),e.value.unique_id?n("span",[n("v-icon",{staticStyle:{color:"red"},attrs:{name:"zap"}})],1):e._e(),n("a",{directives:[{name:"b-modal",rawName:"v-b-modal",value:e.modal_dom_id,expression:"modal_dom_id"}]},[n("v-icon",{attrs:{name:"edit"}})],1)],1)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"0ad2":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",{staticClass:"form-group"},[n("label",[e._v(" Name "),n("input",{directives:[{name:"model",rawName:"v-model.lazy",value:e.value.name,expression:"value.name",modifiers:{lazy:!0}}],staticClass:"form-control",domProps:{value:e.value.name},on:{change:function(t){return e.$set(e.value,"name",t.target.value)}}})])]),n("div",{staticClass:"form-group"},[n("label",[e._v(" Unique ID? "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.value.unique_id,expression:"value.unique_id"}],attrs:{type:"checkbox",id:"unique_id"},domProps:{checked:Array.isArray(e.value.unique_id)?e._i(e.value.unique_id,null)>-1:e.value.unique_id},on:{change:function(t){var n=e.value.unique_id,i=t.target,r=!!i.checked;if(Array.isArray(n)){var a=null,o=e._i(n,a);i.checked?o<0&&e.$set(e.value,"unique_id",n.concat([a])):o>-1&&e.$set(e.value,"unique_id",n.slice(0,o).concat(n.slice(o+1)))}else e.$set(e.value,"unique_id",r)}}})])]),n("div",{staticClass:"form-group"},[n("label",[e._v(" Type "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.value.type,expression:"value.type"}],staticClass:"form-control",on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.value,"type",t.target.multiple?n:n[0])}}},[n("option",{attrs:{disabled:"",value:""}},[e._v("Select one")]),n("option",{attrs:{value:"string"}},[e._v("String")]),n("option",{attrs:{value:"text_area"}},[e._v("Text Area")]),n("option",{attrs:{value:"integer"}},[e._v("Integer")]),n("option",{attrs:{value:"select_one"}},[e._v("Select One")]),e.sub_definition?e._e():n("option",{attrs:{value:"references"}},[e._v("References")]),n("option",{attrs:{value:"expression"}},[e._v("Expression")])])])]),"select_one"==e.value.type?n("div",{staticClass:"form-group"},[n("label",[n("b-list-group",e._l(e.options,(function(t){return n("b-list-group-item",{key:t},[n("a",{staticClass:"float-right",on:{click:function(n){return e.remove_option(t,n)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1),e._v(" "+e._s(t)+" ")])})),1),n("input",{directives:[{name:"model",rawName:"v-model",value:e.option_to_add,expression:"option_to_add"}],staticClass:"form-control",attrs:{placeholder:"New option"},domProps:{value:e.option_to_add},on:{input:function(t){t.target.composing||(e.option_to_add=t.target.value)}}}),n("b-button",{on:{click:e.add_option}},[e._v("Add Option")])],1)]):e._e(),"select_one"!=e.value.type||e.sub_definition?e._e():n("div",{staticClass:"form-group"},[n("label",[e._v(" Transform all "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.old_value,expression:"old_value"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.old_value=t.target.multiple?n:n[0]}}},e._l(e.options,(function(t){return n("option",{key:t},[e._v(e._s(t))])})),0),e._v(" to: "),n("select",{directives:[{name:"model",rawName:"v-model",value:e.new_value,expression:"new_value"}],on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.new_value=t.target.multiple?n:n[0]}}},e._l(e.options,(function(t){return n("option",{key:t},[e._v(e._s(t))])})),0),n("button",{staticClass:"btn btn-danger",on:{click:function(t){return e.$emit("transform-values",e.definition,e.old_value,e.new_value)}}},[e._v("Change")])])]),n("button",{staticClass:"btn btn-danger",on:{click:e.emit_remove}},[e._v("Delete Definition")]),"references"==e.value.type?n("div",{staticClass:"mt-2"},[n("div",{staticClass:"form-group"},[n("p",[e._v("Limit sheets which can be referenced (select none to allow reference of any sheet):")]),e._l(e.database.sheets,(function(t){return n("label",{key:t._id,staticClass:"referenceable-sheet-option"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.value.referenceable_sheet_ids,expression:"value.referenceable_sheet_ids"}],attrs:{type:"checkbox"},domProps:{value:t._id,checked:Array.isArray(e.value.referenceable_sheet_ids)?e._i(e.value.referenceable_sheet_ids,t._id)>-1:e.value.referenceable_sheet_ids},on:{change:function(n){var i=e.value.referenceable_sheet_ids,r=n.target,a=!!r.checked;if(Array.isArray(i)){var o=t._id,s=e._i(i,o);r.checked?s<0&&e.$set(e.value,"referenceable_sheet_ids",i.concat([o])):s>-1&&e.$set(e.value,"referenceable_sheet_ids",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.value,"referenceable_sheet_ids",a)}}}),e._v(" "+e._s(t.name)+" ")])}))],2),n("div",{staticClass:"form-group"},[n("a",{staticClass:"btn btn-primary btn-block",on:{click:e.add_definition}},[e._v("Add sub-definition")]),e._l(e.value.definitions,(function(t,i){return n("div",{key:t.name,staticClass:"references-definition mt-2"},[n("DefinitionDetails",{attrs:{sub_definition:!0,database:e.database},on:{remove:e.remove},model:{value:e.definition.definitions[i],callback:function(t){e.$set(e.definition.definitions,i,t)},expression:"definition.definitions[index]"}})],1)}))],2)]):e._e()])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"0cf2":function(e,t,n){"use strict";n.r(t);var i=n("2766"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"0d8c":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"String",data:function(){return{}},props:{value:String},methods:{update_value:function(e){this.$emit("input",e.target.value)}}})},"0e4e":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group"},[n("textarea",{ref:"the_input",staticClass:"form-control",attrs:{rows:"3"},domProps:{value:e.value},on:{input:e.update_value}})])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"10ed":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"Expression",props:{value:String,definition:Object,database:Object},computed:{calculated_value_and_error:function(){return this.database.evaluate_expression(this.value)},calculated_value:function(){return this.calculated_value_and_error[0]},error:function(){return this.calculated_value_and_error[1]}},methods:{change_value:function(e){this.$emit("input",e.target.value)}}})},1250:function(e,t,n){"use strict";n.r(t);var i=n("8c5b"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"13c1":function(e,t,n){"use strict";n.r(t);var i=n("9177"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},1593:function(e,t,n){"use strict";n.r(t);var i=n("882e"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"1aff":function(e,t,n){"use strict";var i=n("47b1"),r=n.n(i);r.a},"1d17":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",{staticClass:"form-check"},[e._l(e.choices(),(function(t){return n("label",{key:t,staticClass:"form-check-label"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.items,expression:"items"}],staticClass:"form-check-input",attrs:{type:"checkbox"},domProps:{value:t,checked:Array.isArray(e.items)?e._i(e.items,t)>-1:e.items},on:{change:function(n){var i=e.items,r=n.target,a=!!r.checked;if(Array.isArray(i)){var o=t,s=e._i(i,o);r.checked?s<0&&(e.items=i.concat([o])):s>-1&&(e.items=i.slice(0,s).concat(i.slice(s+1)))}else e.items=a}}}),e._v(" "+e._s(t)+" ")])})),e._v(" Select: "),n("div",{staticClass:"btn-group",attrs:{role:"group","aria-label":"Basic example"}},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.select_none}},[e._v("None")]),n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.select_all}},[e._v("All")])])],2)])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"1e4b":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",[e._v("Smallest value: "+e._s(e.min_min))]),n("div",[e._v("Biggest value: "+e._s(e.max_max))]),n("div",{staticClass:"input-group mb-3"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.min,expression:"min"}],staticClass:"form-control",attrs:{type:"number",min:e.min_min,max:e.max},domProps:{value:e.min},on:{input:function(t){t.target.composing||(e.min=t.target.value)}}}),n("input",{directives:[{name:"model",rawName:"v-model",value:e.max,expression:"max"}],staticClass:"form-control",attrs:{type:"number",min:e.min,max:e.max_max},domProps:{value:e.max},on:{input:function(t){t.target.composing||(e.max=t.target.value)}}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.reset}},[e._v("Reset")])])])])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},2766:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"String",data:function(){return{}},props:{value:String},methods:{update_value:function(e){this.$emit("input",e.target.value)}}})},"2cf1":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group"},[n("select",{directives:[{name:"model",rawName:"v-model",value:e.value,expression:"value"}],ref:"the_input",staticClass:"form-control",on:{change:[function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.value=t.target.multiple?n:n[0]},e.update_value]}},[n("option",{attrs:{disabled:"",value:""}},[e._v("Select one")]),e._l(e.definition.options,(function(t){return n("option",{key:t,domProps:{value:t}},[e._v(e._s(t))])}))],2)])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},3145:function(e,t,n){"use strict";var i=n("f7cf"),r=n.n(i);r.a},"360a":function(e,t,n){},"36ae":function(e,t,n){"use strict";n.r(t);var i=n("cdf4"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"38df":function(e,t,n){"use strict";n.r(t);var i=n("001e"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"39aa":function(e,t,n){"use strict";n.r(t);var i=n("0d8c"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"3dfd":function(e,t,n){"use strict";n.r(t);var i=n("580d"),r=n("6f68");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("5c0b");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,null,null);t["default"]=s.exports},"3f84":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"input-group"},[n("input",{ref:"the_input",staticClass:"form-control",domProps:{value:e.value},on:{input:e.update_value}})])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},4036:function(e,t,n){"use strict";n.r(t);var i=n("8e5e"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"43f2":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("b-modal",{attrs:{"ok-only":"",id:e.modal_dom_id,static:!0,title:"Filter: "+e.definition.name,visible:e.visible},on:{hidden:function(t){return e.$emit("definition-filter-modal-hidden",e.definition)}}},[n("b-tabs",{attrs:{"content-class":"mt-3"}},[n("b-tab",{attrs:{title:"General filter",active:""},on:{click:function(t){return e.reset_blank()}}},[n("div",["references"===e.definition.type||"reverse_references"===e.definition.type?n("References",{attrs:{definition:e.definition,values:e.record_values,database:e.database},on:{input:e.handle_input}}):e._e(),"select_one"===e.definition.type?n("SelectOne",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e(),["string","text_area"].includes(e.definition.type)?n("Stringy",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e(),"integer"===e.definition.type?n("Integer",{attrs:{definition:e.definition,values:e.values,database:e.database},on:{input:e.handle_input}}):e._e()],1)]),n("b-tab",{attrs:{title:"Blank filter"}},[n("b-button-group",[n("b-button",{attrs:{pressed:!0===e.blankness_filter},on:{click:function(t){return e.show_only_blank()}}},[e._v("Show only empty")]),n("b-button",{attrs:{pressed:!1===e.blankness_filter},on:{click:function(t){return e.show_only_non_blank()}}},[e._v("Showonly non-empty")])],1)],1)],1)],1)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},4514:function(e,t,n){},"46d1":function(e,t,n){"use strict";n.r(t);var i=n("0ad2"),r=n("1593");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("8294");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"1d3184d4",null);t["default"]=s.exports},"47b1":function(e,t,n){},"4a8f":function(e,t,n){"use strict";n.r(t);var i=n("7166"),r=n("5861");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"1722630c",null);t["default"]=s.exports},"4d0e":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"form-group"},[n("input",{staticClass:"form-control",domProps:{value:e.value},on:{input:e.change_value}})]),n("div",{staticClass:"form-group"},[n("span",{staticClass:"calculated-value"},[e._v(e._s(e.calculated_value))]),n("span",{staticClass:"error"},[e._v(e._s(e.error))])])])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"580d":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("nav",{staticClass:"navbar sticky-top navbar-expand-lg navbar-light bg-light"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.database.project_name,expression:"database.project_name"}],staticClass:"form-control mx-2",attrs:{id:"project_name",type:"text"},domProps:{value:e.database.project_name},on:{input:function(t){t.target.composing||e.$set(e.database,"project_name",t.target.value)}}}),n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal.global-variables-modal",modifiers:{"global-variables-modal":!0}}],staticClass:"btn mx-2",attrs:{variant:"primary"}},[e._v("Edit Global Variables")]),n("button",{staticClass:"btn btn-primary mx-2",on:{click:e.add_sheet}},[e._v("Add Sheet")]),e.database.sheets.length?n("button",{staticClass:"btn btn-primary mx-2",attrs:{href:"#",download:e.database.project_name+".db.json"},on:{click:function(t){return t.preventDefault(),e.download_json_file_data(t)}}},[e._v(" Save JSON ")]):e._e(),n("RecordsSearch",{attrs:{record_ids_to_skip:[],database:e.database,sheet_ids_to_search:[]},on:{"record-selected":e.focus_record}})],1),n("div",{staticClass:"container-fluid"},[n("ul",{staticClass:"nav nav-tabs sticky-top"},e._l(e.database.sheets,(function(t){return n("li",{key:t._id,staticClass:"nav-item"},[n("a",{class:["nav-link","active",{selected:e.current_sheet_id===t._id}],on:{click:function(n){return e.change_sheet(t._id)}}},[n("div",{staticClass:"marker",style:"background-color:"+t.hex_color}),e._v(" "+e._s(t.name)+" ")])])})),0),e._l(e.database.sheets,(function(t){return n("div",{key:t._id},[e.current_sheet_id===t._id?n("Sheet",{attrs:{sheet:t,database:e.database,current_focus:e.current_focus},on:{"focus-sheet-and-record":e.focus_sheet_and_record}}):e._e()],1)})),e.database.sheets.length?e._e():n("div",{class:{hover:e.upload_highlighted},attrs:{id:"file-upload"},on:{drop:function(t){return t.preventDefault(),e.upload(t)},dragover:function(t){return t.preventDefault(),e.highlight_upload(t)},dragleave:function(t){return t.preventDefault(),e.unhighlight_upload(t)}}},[e._v(" Drag here to upload file ")]),n("hr"),n("b-modal",{attrs:{id:"global-variables-modal",title:"Global Variables"}},[n("VariableEditor",{attrs:{variables:e.database.global_variables},on:{update:e.update_global_variables,delete:e.delete_global_variables_key}})],1)],2)])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},5861:function(e,t,n){"use strict";n.r(t);var i=n("6f93"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"5c0b":function(e,t,n){"use strict";var i=n("9c0c"),r=n.n(i);r.a},"5e21":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group"},[n("div",{staticClass:"search"},[n("b-input-group",{attrs:{prepend:"🔎"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.match_text,expression:"match_text"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.match_text},on:{keyup:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"up",38,t.key,["Up","ArrowUp"])?null:e.move_highlight(-1)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"down",40,t.key,["Down","ArrowDown"])?null:e.move_highlight(1)},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.choose_highlighted()}],input:function(t){t.target.composing||(e.match_text=t.target.value)}}})]),e.match_text?n("div",{staticClass:"results"},[n("b-list-group",e._l(e.search_results(),(function(t,i){return n("b-list-group-item",{key:t._id,class:{search_result:!0,highlighted:i==e.highlighted_index},attrs:{button:"",variant:"secondary"},on:{click:function(n){return n.target!==n.currentTarget?null:(n.stopPropagation(),e.choose(t,n))}}},[n("div",{staticClass:"record-result"},[n("span",{staticClass:"sheet-name",style:"background-color:"+t.sheet.hex_color},[e._v(" "+e._s(t.sheet.name)+" ")]),e._v(" » "),e._l(t.description_data(),(function(i,r){return n("span",{key:r,staticClass:"property",on:{click:function(n){return n.stopPropagation(),e.choose(t,n)}}},[n("span",{staticClass:"value"},[e._v(e._s(i))])])}))],2)])})),1)],1):e._e()],1)])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"5f04":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"Sheet",props:{record:Object}})},"62ce":function(e,t,n){"use strict";var i=n("e4b8"),r=n.n(i);r.a},"64ca":function(e,t,n){},6725:function(e,t,n){"use strict";n.r(t);var i=n("1d17"),r=n("aa90");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("6ce1");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"2e6fec0b",null);t["default"]=s.exports},"673b":function(e,t,n){"use strict";n("ac1f"),n("841c"),n("498a"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("2ef0")),o=i.__importDefault(n("ffe7"));t.default=r.default.extend({name:"Stringy",props:["definition","database","values"],data:function(){return{search_query:""}},watch:{search_query:{handler:function(e,t){var n=this;""===a.default.trim(this.search_query)?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(e){var t=new o.default(e,{shouldSort:!1,keys:["data.".concat(n.definition._id)],threshold:.2});return t.search(n.search_query)}))}}},methods:{clear:function(){this.search_query=""}}})},"68fb":function(e,t,n){"use strict";var i=n("cf20"),r=n.n(i);r.a},"6ce1":function(e,t,n){"use strict";var i=n("be4b"),r=n.n(i);r.a},"6d3c":function(e,t,n){"use strict";n("4de4"),n("caad"),n("d3b7"),n("ac1f"),n("6062"),n("2532"),n("3ca3"),n("841c"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("2ef0"));t.default=r.default.extend({name:"References",data:function(){return{match_text:null,currently_edited_reference:null,highlighted_index:null}},props:{record_ids_to_skip:Array,record_ids_to_limit_to:Array,database:Object,use_source_record:Boolean,sheet_ids_to_search:Array},watch:{match_text:{handler:function(e,t){null!=e&&""!==e||(this.highlighted_index=null)}}},methods:{search_results:function(){var e=this;if(null==this.match_text)return[];var t=a.default(this.database.search("".concat(this.match_text),new Set(this.sheet_ids_to_search)));return this.record_ids_to_skip&&t.reject((function(t){return e.record_ids_to_skip.includes(t._id)})),this.record_ids_to_limit_to&&t.filter((function(t){return e.record_ids_to_limit_to.includes(t._id)})),t.take(7).value()},choose:function(e,t){this.$emit("record-selected",e),this.match_text=null,this.highlighted_index=null},choose_highlighted:function(){this.choose(this.search_results()[this.highlighted_index])},move_highlight:function(e){if(null!=this.match_text)if(null==this.highlighted_index)this.highlighted_index=0;else{this.highlighted_index=this.highlighted_index+e,this.highlighted_index<0&&(this.highlighted_index=0);var t=this.search_results().length;this.highlighted_index>=t&&(this.highlighted_index=t-1)}}}})},"6de4":function(e,t,n){"use strict";n.r(t);var i=n("10ed"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"6f68":function(e,t,n){"use strict";n.r(t);var i=n("78c7"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"6f93":function(e,t,n){"use strict";n("99af"),n("4de4"),n("c975"),n("d81d"),n("45fc"),n("a434"),n("d3b7"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("8d65")),o=i.__importDefault(n("b18b")),s=i.__importStar(n("a4c9")),u=i.__importDefault(n("2ef0"));t.default=r.default.extend({name:"Reference",props:{definition:Object,database:s.Database,values:Array},components:{RecordResult:a.default,RecordsSearch:o.default},data:function(){return{match_text:null,currently_filtered_records:[]}},methods:{filtered_record_ids:function(){return u.default.map(this.values,"_id")},remove:function(e){var t=u.default(this.currently_filtered_records).map("_id").indexOf(e._id);this.currently_filtered_records.splice(t,1),this.emit_input()},record_selected:function(e){r.default.set(this,"currently_filtered_records",this.currently_filtered_records.concat([e])),this.emit_input()},emit_input:function(){var e=this.currently_filtered_records,t=u.default.map(this.currently_filtered_records,"_id"),n=this.definition;0===t.length?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(i){return u.default.filter(i,(function(i){if("reverse_references"===n.type)return u.default.some(e,(function(e){return u.default.some(e.value_for_definition(n),(function(e){return e.record._id===i._id}))}));var r=u.default.map(i.value_for_definition(n)||[],"record._id");return u.default.intersection(t,r).length>0}))}))}}})},7010:function(e,t,n){"use strict";var i=n("e783"),r=n.n(i);r.a},7166:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" "+e._s(e.values.length)+" references used "),e._l(e.currently_filtered_records,(function(t){return n("div",{key:t._id,staticClass:"referenced-record"},[n("a",{staticClass:"remove",on:{click:function(n){return n.stopPropagation(),e.remove(t)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1),e.definition.definitions.length?n("a",{staticClass:"edit",on:{click:function(t){return t.stopPropagation(),e.edit_properties(e.reference)}}},[n("v-icon",{attrs:{name:"edit"}})],1):e._e(),n("RecordResult",{attrs:{record:t,database:e.database}})],1)})),n("RecordsSearch",{attrs:{record_ids_to_limit_to:e.filtered_record_ids(),database:e.database,sheet_ids_to_search:e.definition.referenceable_sheet_ids},on:{"record-selected":e.record_selected}})],2)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},"74fb":function(e,t,n){"use strict";n.r(t);var i=n("b6c5"),r=n("7b9e");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("ad98");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"01f97d28",null);t["default"]=s.exports},"776d":function(e,t,n){"use strict";n.r(t);var i=n("673b"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"78c7":function(e,t,n){"use strict";n("d3b7"),n("ac1f"),n("3ca3"),n("841c"),n("ddb0"),n("2b3d"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("5f5b")),o=i.__importDefault(n("3459")),s=i.__importDefault(n("fceb")),u=i.__importDefault(n("cbe0")),d=i.__importDefault(n("b18b"));r.default.use(a.default),r.default.use(o.default,"v-icon");var c=i.__importStar(n("a4c9"));t.default=r.default.extend({name:"app",components:{VariableEditor:u.default,Sheet:s.default,RecordsSearch:d.default},data:function(){var e=new c.Database("Project Name",{});return{database:e,current_sheet_id:null,current_focus:null,upload_highlighted:!1,show_json:!1}},mounted:function(){var e=new URLSearchParams(window.location.search),t=e.get("file_url");t&&this.load_database_from_url(t)},methods:{load_database_from_url:function(e){var t=this;fetch(e).then((function(e){e.json().then((function(e){t.database=c.Database.from_saved(e),t.current_sheet_id=t.database.sheets[0]._id}))}))},update_global_variables:function(e,t){r.default.set(this.database.global_variables,e,t)},delete_global_variables_key:function(e){r.default.delete(this.database.global_variables,e)},upload:function(e){var t=this;this.upload_highlighted=!1,e.dataTransfer.files.length>1&&alert("You cannot upload more than one file");var n=e.dataTransfer.files[0],i=(e.dataTransfer.items[0],new FileReader);i.onload=function(e){t.database=c.Database.from_saved(JSON.parse(e.target.result)),t.current_sheet_id=t.database.sheets[0]._id},i.readAsText(n)},highlight_upload:function(){this.upload_highlighted=!0},unhighlight_upload:function(){this.upload_highlighted=!1},add_sheet:function(){var e=this.database.sheets.length+1,t=new c.Sheet(this.database,"Sheet #".concat(e),null,null,[],null,null,!0,[]);this.current_sheet_id=t._id},change_sheet:function(e){this.current_sheet_id=e},focus_record:function(e){this.focus_sheet_and_record(e.sheet._id,e._id)},focus_sheet_and_record:function(e,t){this.current_focus={sheet_id:e,record_id:t},this.current_sheet_id=e,window.setTimeout((function(){var e=document.getElementById("record-".concat(t));e&&e.scrollIntoView({behavior:"smooth",block:"center"})}),1)},json:function(){return JSON.stringify(this.database.json_data(),null,2)},json_file_data_url:function(){var e=new Blob([this.json()],{type:"application/json"});return URL.createObjectURL(e)},download_json_file_data:function(){var e=new Blob([this.json()],{type:"application/json"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=this.database.project_name+".db.json",t.click(),URL.revokeObjectURL(t.href)},toggle_json:function(){this.show_json=!this.show_json}},computed:{}})},"7b9e":function(e,t,n){"use strict";n.r(t);var i=n("fb57"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"7c57":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[n("div",{staticClass:"input-group mb-3"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.search_query,expression:"search_query"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.search_query},on:{input:function(t){t.target.composing||(e.search_query=t.target.value)}}}),n("div",{staticClass:"input-group-append"},[n("button",{staticClass:"btn btn-primary",attrs:{type:"button"},on:{click:e.clear}},[e._v("Clear")])])])])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},8294:function(e,t,n){"use strict";var i=n("64ca"),r=n.n(i);r.a},"882e":function(e,t,n){"use strict";n("b0c0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("2ef0")),o=i.__importStar(n("a4c9"));t.default=r.default.extend({name:"DefinitionDetails",data:function(){return{option_to_add:null,old_value:null,new_value:null}},props:{value:Object,sub_definition:Boolean,database:o.Database},computed:{definition:function(){return this.value},options:function(){return this.value.options||[]}},methods:{add_option:function(){var e=this.options;e.push(this.option_to_add),this.value.options=a.default.uniq(e),this.option_to_add=null},remove_option:function(e,t){confirm("Do you really want to remove the option `".concat(e,"`?"))&&(this.value.options=a.default.reject(this.options,(function(t){return t==e})))},emit_remove:function(){confirm("Do you really want to delete the definition ".concat(this.definition.name,"?"))&&this.$emit("remove",this.definition)},remove:function(e,t){this.$emit("remove-sub-definition",this.value,e)},add_definition:function(){var e=a.default.cloneDeep(this.value),t=new o.Definition({name:"Def #1",type:"string"});null==e.definitions&&(e.definitions=[]),e.definitions.push(t),this.$emit("input",e)}}})},"8b22":function(e,t,n){"use strict";n.r(t);var i=n("6d3c"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},"8c5b":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"SelectOne",data:function(){return{}},props:{value:String,definition:Object},methods:{update_value:function(e){this.$emit("input",e.target.value)}}})},"8d65":function(e,t,n){"use strict";n.r(t);var i=n("07a7"),r=n("0538");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("62ce");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"75a6f523",null);t["default"]=s.exports},"8e5e":function(e,t,n){"use strict";n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("8d65")),o=i.__importStar(n("a4c9"));t.default=r.default.extend({name:"References",components:{RecordResult:a.default,Field:function(){return Promise.resolve().then((function(){return i.__importStar(n("c08e"))}))}},data:function(){return{match_text:null,currently_edited_reference:null}},props:{value:Array,record:Object,definition:o.ReferencesDefinition,database:Object,use_source_record:Boolean,sheet:o.Sheet},computed:{references_definition_edit_modal_id:function(){return null==this.record?"":"references-definitions-edit-modal-"+(this.use_source_record?"use-source-":"")+this.record._id+this.definition._id},definition_referenceable_sheet_ids_set:function(){return this.use_source_record?new Set([this.sheet._id]):this.definition?new Set(this.definition.referenceable_sheet_ids):new Set}},methods:{reference_key:function(e){return this.use_source_record?e.source_record._id:e.record._id},remove:function(e){e.remove()},record_clicked:function(e){this.$emit("record-clicked",e)},edit_properties:function(e){this.$bvModal.show(this.references_definition_edit_modal_id),r.default.set(this,"currently_edited_reference",e)},valid_sheet:function(e){return!this.definition||(0==this.definition_referenceable_sheet_ids_set.size||this.definition_referenceable_sheet_ids_set.has(e._id))}}})},9177:function(e,t,n){"use strict";n("99af"),n("d81d"),n("07ac"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("08c6")),o=i.__importDefault(n("74fb")),s=i.__importDefault(n("df79")),u=i.__importDefault(n("b18b")),d=i.__importDefault(n("9f79")),c=i.__importDefault(n("bd5b")),l=i.__importDefault(n("c2ae")),f=i.__importStar(n("a4c9")),_=i.__importDefault(n("2ef0"));t.default=r.default.extend({name:"Field",components:{Expression:a.default,Integer:o.default,References:s.default,RecordsSearch:u.default,SelectOne:d.default,String:c.default,TextArea:l.default},props:{record:Object,definition:Object,database:f.Database},data:function(){return{recompute:0}},computed:{record_value:function(){this.recompute;return this.record.value_for_definition(this.definition)},reference_sheet:function(){return this.record_value&&this.record_value[0]?this.record_value[0].record.sheet:void 0}},methods:{record_clicked:function(e){this.$emit("record-clicked",e)},add_reference:function(e,t,n){this.$emit("add-reference",e,t,n),this.mark_for_recompute()},reference_record_selected:function(e){this.$emit("reference-record-selected",e),this.mark_for_recompute()},update_value:function(e){this.mark_for_recompute(),this.record.update_value(this.definition,e)},mark_for_recompute:function(){"expression"===this.definition.type&&(this.recompute=this.recompute+1)},record_ids_to_skip:function(){return[this.record._id].concat(_.default.map(this.record_value,"record._id")||[])},grouped_references:function(){var e=_.default.groupBy(this.record_value,"record.sheet._id");return _.default(Object.values(e)).sortBy((function(e){return e[0].record.sheet._id})).map((function(e){var t=e[0].record.sheet;return{references:_.default.uniq(e),sheet:t}})).value()}}})},"936c":function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("b-button",{directives:[{name:"b-modal",rawName:"v-b-modal",value:"sheet-modal-"+e.sheet._id,expression:"'sheet-modal-' + sheet._id"}],staticClass:"btn btn-primary"},[e._v("Edit Sheet")]),n("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.sheet.add_definition()}}},[e._v("Add Column")]),n("button",{staticClass:"btn btn-primary add-row-btn",on:{click:function(t){return e.add_record("top")}}},[e._v("Add Record")]),e._l(e.sheet.definitions,(function(t){return n("DefinitionFilterModal",{key:t._id+"-modal",attrs:{definition:t,values:e.values_for(t),database:e.database,visible:e.currently_edited_definition===t},on:{input:e.set_filter,"definition-filter-modal-hidden":function(t){return e.set_currently_edited_definition(null)}}})})),e._l(e.definitions_referring_to_sheet,(function(t){return n("DefinitionFilterModal",{key:"reverse-definition-test-"+t.definition._id,attrs:{definition:e.reverse_references_definition(t),values:e.source_values_for(t),database:e.database,visible:e.currently_edited_reverse_definition===t.definition},on:{input:e.set_filter,"definition-filter-modal-hidden":function(t){return e.set_currently_edited_reverse_definition(null)}}})})),n("table",{staticClass:"table table-striped table-bordered"},[n("thead",{staticClass:"thead-light"},[n("tr",[n("th",{attrs:{colspan:"100%"}},[n("h4",[e._v(" "+e._s(e.total_count)+" total rows "),n("span",{class:{"filter-display":!0,"filter-has-limited-rows":e.filter_has_limited_rows}},[e._v(" (filtered to "+e._s(e.records_to_display.length)+" record(s)) ")])])])]),n("tr",{ref:"columns_to_display",staticClass:"columns-to-display"},[n("th",{attrs:{colspan:"100%"}},[n("h3",[e._v("Columns to Display")]),e._l(e.sheet.definitions,(function(t){return n("div",{key:"column-to-display-"+t._id,staticClass:"form-check form-check-inline"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.sheet.definition_ids_to_display,expression:"sheet.definition_ids_to_display"}],staticClass:"form-check-input",attrs:{type:"checkbox"},domProps:{value:t._id,checked:Array.isArray(e.sheet.definition_ids_to_display)?e._i(e.sheet.definition_ids_to_display,t._id)>-1:e.sheet.definition_ids_to_display},on:{change:function(n){var i=e.sheet.definition_ids_to_display,r=n.target,a=!!r.checked;if(Array.isArray(i)){var o=t._id,s=e._i(i,o);r.checked?s<0&&e.$set(e.sheet,"definition_ids_to_display",i.concat([o])):s>-1&&e.$set(e.sheet,"definition_ids_to_display",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.sheet,"definition_ids_to_display",a)}}}),e._v(" "+e._s(t.name)+" ")])])})),e._l(e.definitions_referring_to_sheet,(function(t){return n("div",{key:"reverse-column-to-display-"+t.definition._id,staticClass:"form-check form-check-inline"},[n("label",[n("input",{directives:[{name:"model",rawName:"v-model",value:e.sheet.definition_ids_referring_to_sheet_to_display,expression:"sheet.definition_ids_referring_to_sheet_to_display"}],staticClass:"form-check-input",attrs:{type:"checkbox"},domProps:{value:t.definition._id,checked:Array.isArray(e.sheet.definition_ids_referring_to_sheet_to_display)?e._i(e.sheet.definition_ids_referring_to_sheet_to_display,t.definition._id)>-1:e.sheet.definition_ids_referring_to_sheet_to_display},on:{change:function(n){var i=e.sheet.definition_ids_referring_to_sheet_to_display,r=n.target,a=!!r.checked;if(Array.isArray(i)){var o=t.definition._id,s=e._i(i,o);r.checked?s<0&&e.$set(e.sheet,"definition_ids_referring_to_sheet_to_display",i.concat([o])):s>-1&&e.$set(e.sheet,"definition_ids_referring_to_sheet_to_display",i.slice(0,s).concat(i.slice(s+1)))}else e.$set(e.sheet,"definition_ids_referring_to_sheet_to_display",a)}}}),e._v(" "+e._s(t.sheet.name)+" - "+e._s(t.definition.name)+" ")])])}))],2)]),n("tr",{ref:"table_header",staticClass:"table-header"},[n("th"),e._l(e.sheet.definitions,(function(t){return[e.should_display_definition(t)?n("th",{key:t._id,staticClass:"field-cell"},[n("Definition",{attrs:{value:t,database:e.database},on:{input:function(n){return e.replace_definition(t._id,n)},remove:function(n){return e.remove_definition(t)},"remove-sub-definition":e.remove_sub_definition,"transform-values":e.transform_values}}),n("span",{on:{click:function(n){e.currently_edited_definition=t}}},[n("v-icon",{class:{notice:e.currently_edited_definition===t,warning:e.filtering_on(t._id)},attrs:{name:"filter"}})],1),e.sortable(t)?n("span",[n("a",{on:{click:function(n){return e.sort(t,"desc")}}},[n("v-icon",{attrs:{name:"chevron-down"}})],1),n("a",{on:{click:function(n){return e.sort(t,"asc")}}},[n("v-icon",{attrs:{name:"chevron-up"}})],1)]):e._e()],1):e._e()]})),e._l(e.definitions_referring_to_sheet,(function(t){return[e.should_display_definition_referring_to_sheet(t)?n("th",{key:"reverse-definition-"+t.definition._id},[e._v(" "+e._s(t.sheet.name)+" - "+e._s(t.definition.name)+" "),n("span",{on:{click:function(n){e.currently_edited_reverse_definition=t.definition}}},[n("v-icon",{class:{notice:e.currently_edited_reverse_definition===t.definition,warning:e.filtering_on(t.definition._id)},attrs:{name:"filter"}})],1)]):e._e()]})),n("th")],2)]),e.currently_edited_record?n("div",[n("b-modal",{attrs:{"ok-only":"",size:"lg",id:"edit-record-modal","modal-class":"record-modal",title:"Edit Record",visible:!0},scopedSlots:e._u([e.current_edit_new_record_position?{key:"modal-footer",fn:function(){return[n("div",{staticClass:"w-100"},[n("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(t){return e.add_record(e.current_edit_new_record_position)}}},[e._v(" Save and Add New ")]),n("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:function(t){return e.stop_editing_record()}}},[e._v(" Save ")])],1)]},proxy:!0}:null],null,!0)},[n("button",{on:{click:function(t){return e.focus_sheet_and_record(e.currently_edited_record.sheet._id,e.currently_edited_record._id)}}},[e._v("Focus Record in Sheet")]),e._l(e.currently_edited_record.sheet.definitions,(function(t){return n("div",{key:t._id,staticClass:"form-inline"},[n("label",[n("strong",[e._v(e._s(t.name))]),n("Field",{attrs:{record:e.currently_edited_record,definition:t,database:e.database},on:{"add-reference":e.add_reference,"record-clicked":e.edit_record,"reference-record-selected":function(n){var i=arguments.length,r=Array(i);while(i--)r[i]=arguments[i];return e.reference_record_selected.apply(void 0,[e.currently_edited_record,t].concat(r))}}})],1)])}))],2)],1):e._e(),e._l(e.records_to_display,(function(t){return[n("tr",{key:t._id,class:{selected:e.record_focused(t)},attrs:{id:"record-"+t._id}},[n("td",[n("b-button",{staticClass:"btn btn-primary",on:{click:function(n){return e.edit_record(t)}}},[e._v("Edit")])],1),e._l(e.sheet.definitions,(function(i){return[e.should_display_definition(i)?n("td",{key:i._id},[n("Field",{attrs:{record:t,definition:i,database:e.database},on:{"record-clicked":e.edit_record,"reference-record-selected":function(n){var r=arguments.length,a=Array(r);while(r--)a[r]=arguments[r];return e.reference_record_selected.apply(void 0,[t,i].concat(a))}}})],1):e._e()]})),e._l(e.definitions_referring_to_sheet,(function(i){return[e.should_display_definition_referring_to_sheet(i)?n("td",{key:"reverse-definition-"+i.definition._id},[n("References",{attrs:{value:e.referencer_reference_references_for(e.sheet,i.definition,t),record:t,definition:i.definition,database:e.database,sheet:i.sheet,use_source_record:!0},on:{"record-clicked":e.edit_record}}),n("RecordsSearch",{attrs:{record_ids_to_skip:e.referencer_reference_references_for_record_ids_to_skip(e.sheet,i.definition,t),database:e.database,use_source_record:!0,sheet_ids_to_search:[i.sheet._id]},on:{"record-selected":function(n){var r=arguments.length,a=Array(r);while(r--)a[r]=arguments[r];return e.reverse_reference_record_selected.apply(void 0,[t,i.definition].concat(a))}}})],1):e._e()]})),n("td",[n("a",{staticClass:"remove",on:{click:function(n){return e.remove_row(t._id)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1)])],2)]}))],2),n("button",{staticClass:"btn btn-primary add-row-btn",on:{click:function(t){return e.add_record("bottom")}}},[e._v("Add Record")]),n("b-modal",{attrs:{"ok-only":"",id:"sheet-modal-"+e.sheet._id,title:"Edit Sheet"}},[n("div",{staticClass:"form-group"},[n("label",[e._v(" Name "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.sheet.name,expression:"sheet.name"}],staticClass:"form-control",domProps:{value:e.sheet.name},on:{input:function(t){t.target.composing||e.$set(e.sheet,"name",t.target.value)}}})])]),n("div",{staticClass:"form-group"},[n("label",[e._v(" Color "),n("ChromePicker",{attrs:{value:e.colors},on:{input:e.update_color}})],1)]),n("h1",[e._v("Column order")]),n("h2",[e._v("(drag to reorder)")]),n("draggable",{attrs:{tag:"ul"},model:{value:e.sheet.definitions,callback:function(t){e.$set(e.sheet,"definitions",t)},expression:"sheet.definitions"}},e._l(e.sheet.definitions,(function(t){return n("div",{key:t._id,staticClass:"list-group-item"},[e._v(" "+e._s(t.name)+" ")])})),0)],1)],2)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},9862:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"VariableEditor",data:function(){return{new_key:null}},props:{variables:Object},methods:{add_variable:function(){this.new_key&&(this.$emit("update",this.new_key,"123"),this.new_key=null)},update_variable:function(e,t){this.$emit("update",e,t.target.value)},delete_variable:function(e){this.$emit("delete",e)}}})},"9c0c":function(e,t,n){},"9dd3":function(e,t,n){},"9f79":function(e,t,n){"use strict";n.r(t);var i=n("2cf1"),r=n("1250");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("c5e8");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"037c2dcb",null);t["default"]=s.exports},a4c9:function(e,t,n){"use strict";n("4de4"),n("7db0"),n("c740"),n("5db7"),n("4160"),n("caad"),n("d81d"),n("13d5"),n("a434"),n("73d9"),n("b0c0"),n("d3b7"),n("ac1f"),n("2532"),n("841c"),n("498a"),n("159b"),n("ddb0");var i=n("5bc3"),r=n("ed6d"),a=n("2d0d"),o=n("970b");Object.defineProperty(t,"__esModule",{value:!0}),t.Database=t.Sheet=t.Reference=t.Record=t.DataObject=t.ReferencesDefinition=t.Definition=void 0;var s=n("9ab4"),u=s.__importDefault(n("2ef0")),d=s.__importDefault(n("ffe7")),c=n("430b").Parser,l=n("e144").v1,f=function e(t){o(this,e),this._id=t._id||l(),this.name=t.name,this.type=t.type,this.unique_id=t.unique_id,this.options=t.options};t.Definition=f;var _=function(e){r(n,e);var t=a(n);function n(e){var i;return o(this,n),i=t.call(this,e),i.definitions=e.definitions||[],i.referenceable_sheet_ids=e.referenceable_sheet_ids||[],i}return i(n,[{key:"references_sheet",value:function(e){return 0===this.referenceable_sheet_ids.length||this.referenceable_sheet_ids.includes(e._id)}}]),n}(f);t.ReferencesDefinition=_;var h=function(e){return e["_id"]?e:u.default.assign(e,{_id:l()})},v=function(e,t){return u.default.reduce(t,(function(t,n){return u.default.set(t,n.name,e[n._id])}),{})},p=function(e,t){return u.default.reduce(t,(function(t,n){return u.default.set(t,n._id,e[n.name])}),{})},m=function(){function e(t){o(this,e),this.data=t}return i(e,[{key:"value_for_definition",value:function(e){return this.data[e._id]}},{key:"sort_value_for_definition",value:function(e,t){return"expression"==e.type?t.evaluate_expression(this.data[e._id])[0]:this.value_for_definition(e)}},{key:"update_value",value:function(e,t){u.default.set(this.data,e._id,t)}},{key:"empty",value:function(){}}]),e}();t.DataObject=m;var b=function(e){r(n,e);var t=a(n);function n(e,i){var r;return o(this,n),r=t.call(this,e),r.data=u.default(e).mapKeys((function(e,t){return"_"===t[0]?t:i.definitions_by_name[t]._id})).tap(h).value(),r.sheet=i,r}return i(n,[{key:"values",value:function(){var e=this;return u.default.mapKeys(this.data,(function(t,n){return"_"===n[0]?n:e.sheet.definitions_by_id[n].name}))}},{key:"delete_definition",value:function(e){u.default.set(this,"data",u.default.omit(this.data,e._id))}},{key:"delete_sub_definition",value:function(e,t){this.transform_value(e,(function(e){return u.default.map(e,(function(e){return u.default.set(e,"data",u.default.omit(e.data,t._id))}))}))}},{key:"transform_value",value:function(e,t){u.default.set(this,["data",e._id],t(this.data[e._id]))}},{key:"description_data",value:function(){var e=this.sheet.unique_id_field(),t={};return t[e]=this.values()[e],t}},{key:"_id",get:function(){return this.data._id}}]),n}(m);t.Record=b;var y=function(e){r(n,e);var t=a(n);function n(e,i,r,a){var s;return o(this,n),s=t.call(this,a),s.record=e,s.source_record=i,s.definition=r,s}return i(n,[{key:"remove",value:function(){var e=this;this.source_record.transform_value(this.definition,(function(t){return u.default.reject(t,(function(t){return t.record._id==e.record._id}))}))}}]),n}(m);t.Reference=y;var g=function(){function e(t,n,i,r,a,s,d,c,h){var v=this;o(this,e),this.database=t,this.database.add_sheet(this),this._id=i||l(),this.name=n,this.definitions=u.default.map(a,(function(e){return"references"===e.type?new _(e):new f(e)})),this.update_definition_caches(),this.definition_ids_to_display=s||u.default.map(a,"_id"),this.definition_ids_referring_to_sheet_to_display=d||[],this.display_referencers=null==c||c,e.last_used_hex_color=e.last_used_hex_color+1,this.hex_color=r||e.hex_colors[e.last_used_hex_color],this.records_data=[],this.records=u.default.map(h,(function(e){return new b(e,v)}))}return i(e,[{key:"schema",value:function(){return this.definitions}},{key:"find_by_id",value:function(e){return u.default.find(this?this.records_data:[],{_id:e})}},{key:"add_definition",value:function(){var e=this.definitions.length+1,t=h({name:"Column #".concat(e),type:"string"});this.definitions.push(t),this.update_definition_caches(),this.definition_ids_to_display.push(t._id)}},{key:"update_definition_caches",value:function(){this.definitions_by_id=u.default.keyBy(this.definitions,"_id"),this.definitions_by_name=u.default.keyBy(this.definitions,"name")}},{key:"add_row",value:function(e){var t=new b({},this);return u.default.each(this.definitions,(function(e){t.update_value(e,null)})),"top"==e?this.records.splice(0,0,t):this.records.splice(this.records.length,1,t),t}},{key:"remove_row",value:function(e){this.records=u.default.reject(this.records,(function(t){return t._id===e}))}},{key:"translate_record",value:function(e){var t=u.default.keyBy(this.definitions,"_id");return u.default.mapKeys(e,(function(e,n){return"_"===n[0]?n:t[n].name}))}},{key:"record_values",value:function(e){var t=this.unique_id_field(),n={};return n[t]=e[t],n}},{key:"unique_id_field",value:function(){var e=u.default(this.definitions).find({unique_id:!0});return e?e.name:"_id"}},{key:"json_data",value:function(){return{_id:this._id,name:this.name,hex_color:this.hex_color,definitions:this.definitions,definition_ids_to_display:this.definition_ids_to_display,definition_ids_referring_to_sheet_to_display:this.definition_ids_referring_to_sheet_to_display,display_referencers:this.display_referencers}}},{key:"delete_definition",value:function(e){var t=this,n=this.find_definition(e);u.default.each(this.records,(function(e){e.delete_definition(n)})),u.default.pull(this.definition_ids_to_display,n._id),this.database.sheets.forEach((function(e){u.default.pull(t.definition_ids_referring_to_sheet_to_display,n._id)})),u.default.pull(this.definitions,n)}},{key:"delete_sub_definition",value:function(e,t){u.default.each(this.records,(function(n){n.delete_sub_definition(e,t)})),u.default.set(e,"definitions",u.default.without(e.definitions,t))}},{key:"find_definition",value:function(e){var t=u.default.find(this.definitions,{_id:e});if(!t)throw"Unable to find definition: ".concat(e);return t}},{key:"replace_definition",value:function(e,t){var n=u.default.findIndex(this.definitions,{_id:e});this.definitions[n]=t}},{key:"transform_values",value:function(e,t,n){return this.records_data=this.records_data.map((function(i){return i[e]===t?u.default.set(i,e,n):i}))}}]),e}();t.Sheet=g,g.hex_colors=["#D11141","#00B159","#00AEDB","#F37735","#FFC425"],g.last_used_hex_color=-1;var k=function(){function e(t,n){o(this,e),this.description_types=["string","text_area","select_one"],this.sheets=[],this.project_name=t,this.global_variables=n}return i(e,[{key:"finalize_load",value:function(){var e=this;u.default.each(this.sheets,(function(t){u.default.each(t.records,(function(n){var i=u.default.filter(t.definitions,{type:"references"});u.default.each(i,(function(t){e.finalize_reference_record(n,t)}));var r=u.default.filter(t.definitions,{type:"expression"});u.default.each(r,(function(t){e.finalize_expression_record(n,t)}))}))}))}},{key:"finalize_reference_record",value:function(e,t){e.transform_value(t,(function(n){return u.default.compact(u.default.map(n||[],(function(n){var i=n.sheet_id,r=n.record_id,a=n.data,o=e.sheet.database.find_sheet(i);if(void 0==o)throw"Could not find sheet ID: ".concat(i);var s=u.default.find(o.records,{_id:r});return void 0==s?null:new y(s,e,t,p(a,t.definitions))})))}))}},{key:"finalize_expression_record",value:function(e,t){e.transform_value(t,(function(e){return null!=e?e.expression_string:e}))}},{key:"add_sheet",value:function(e){this.sheets.push(e)}},{key:"search",value:function(e,t){var n=this,i=u.default(this.sheets).flatMap((function(e){return e.definitions})).filter((function(e){return n.description_types.includes(e.type)})).map((function(e){return"data.".concat(e._id)})).value(),r=this.sheets;t.size&&(r=u.default.filter(r,(function(e){return t.has(e._id)})));var a=u.default.flatMap(r,"records"),o=new d.default(a,{keys:i,threshold:.3});return o.search(e)}},{key:"fetch_record_reference",value:function(e){var t=u.default.find(this.sheets,(function(t){return t._id===e.sheet_id}));if(!t)return null;var n=t.find_by_id(e.record_id);return n?{sheet:t,id:e.record_id,record:t.translate_record(n)}:null}},{key:"find_sheet",value:function(e){return u.default.find(this.sheets,{_id:e})}},{key:"referencer_reference_references",value:function(){return u.default.mapValues(u.default.reduce(this.sheets,(function(e,t){var n=u.default.filter(t.definitions,{type:"references"});return t.records.forEach((function(t){n.forEach((function(n){(t.value_for_definition(n)||[]).forEach((function(t){var i=t.record._id;null==e[i]&&(e[i]={}),null==e[i][n._id]&&(e[i][n._id]=[]),e[i][n._id].push(t)}))}))})),e}),{}),(function(e){return u.default.mapValues(e,u.default.uniq)}))}},{key:"definitions_referring_to",value:function(e){return u.default.flatMap(this.sheets,(function(t){return u.default(t.definitions).filter((function(t){return!!t.references_sheet&&!!t.references_sheet(e)})).map((function(e){return{sheet:t,definition:e}})).value()}))}},{key:"json_data_bak",value:function(){var e=this,t=u.default.reduce(this.sheets,(function(e,t){return e[t.name]=t.json_data(),e}),{}),n=u.default.reduce(this.sheets,(function(e,t){return u.default.set(e,t._id,u.default.find(t.definitions,{unique_id:!0}))}),{}),i=u.default.reduce(this.sheets,(function(t,i){var r=u.default.filter(i.definitions,(function(e){return"references"==e.type}));return t[i.name]=u.default.map(i.records,(function(t){return u.default.reduce(r,(function(t,i){var r=t[i.name];return r&&r.length&&(t[i.name]=u.default.map(r,(function(t){var i=e.fetch_record_reference(t);if(i){t=u.default.set(t,"sheet_name",i.sheet.name);var r=n[i.sheet._id];return r&&(t=u.default.set(t,r.name,i.record[r.name])),t}return t}))),t}),t.values())})),t}),{});return{global_variables:this.global_variables,sheets:t,records:i}}},{key:"json_data",value:function(){var e=this,t=u.default.reduce(this.sheets,(function(e,t){return e[t.name]=t.json_data(),e}),{}),n=u.default.reduce(this.sheets,(function(e,t){return u.default.set(e,t._id,u.default.find(t.definitions,{unique_id:!0}))}),{}),i=u.default.reduce(this.sheets,(function(t,i){var r=u.default.filter(i.definitions,(function(e){return"references"==e.type})),a=u.default.filter(i.definitions,(function(e){return"expression"==e.type}));return t[i.name]=u.default.map(i.records,(function(t){var i=t.values();return i=u.default.reduce(r,(function(e,t){var i=e[t.name];return i&&i.length&&(e[t.name]=u.default.map(i,(function(e){var i=e.record,r=v(e.data,t.definitions),a={record_id:i._id,sheet_id:i.sheet._id,sheet_name:i.sheet.name,data:r},o=n[i.sheet._id];return o&&(a=u.default.set(a,o.name,i.value_for_definition(o))),a}))),e}),i),i=u.default.reduce(a,(function(t,n){var i=e.evaluate_expression(t[n.name])[0];return i&&(t[n.name]={expression_string:t[n.name],calculated_value:i}),t}),i),i})),t}),{});return{project_name:this.project_name,global_variables:this.global_variables,sheets:t,records:i}}},{key:"evaluate_expression",value:function(e){if(""===u.default.trim(e))return[null,null];var t,n,i=new c;try{t=i.evaluate(e,this.global_variables),n=null}catch(r){t=null,n=r}return[t,n]}}],[{key:"from_saved",value:function(t){var n=new e(t.project_name,t.global_variables||{});u.default.map(t.sheets,(function(e){return new g(n,e.name,e._id,e.hex_color,e.definitions,e.definition_ids_to_display,e.definition_ids_referring_to_sheet_to_display,e.display_referencers,t.records[e.name])}));return n.finalize_load(),n}}]),e}();t.Database=k},a855:function(e,t,n){"use strict";n("99af"),n("c740"),n("5db7"),n("d81d"),n("13d5"),n("a434"),n("73d9"),n("b0c0"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("d6dc")),o=i.__importDefault(n("0726")),s=i.__importDefault(n("df79")),u=i.__importDefault(n("b18b")),d=i.__importDefault(n("c08e")),c=n("c345"),l=i.__importDefault(n("310e")),f=i.__importStar(n("a4c9")),_=i.__importDefault(n("2ef0"));t.default=r.default.extend({name:"Sheet",mounted:function(){var e,t=this.$refs.columns_to_display.querySelector("th");if(t){var n=t.getBoundingClientRect().height||0;e=Math.round(n)+90}else e=170;var i=this.$refs.table_header.querySelectorAll("th");_.default.each(i,(function(t){t.style.top="".concat(e,"px")}))},components:{Definition:a.default,DefinitionFilterModal:o.default,References:s.default,RecordsSearch:u.default,Field:d.default,ChromePicker:c.Chrome,draggable:l.default},data:function(){return{colors:{hex:this.sheet.hex_color},filters:{},currently_edited_record:null,recompute_database_reference_referencer_references:0,current_edit_new_record_position:"top",currently_edited_definition:null,currently_edited_reverse_definition:null}},props:{sheet:f.Sheet,database:f.Database,current_focus:Object},computed:{records_to_display:function(){return _.default(this.filters).values().compact().reduce((function(e,t){return t(e)}),this.sheet.records)},total_count:function(){return this.sheet.records.length},filter_has_limited_rows:function(){return this.records_to_display.length!==this.total_count},database_reference_referencer_references:function(){this.recompute_database_reference_referencer_references;return this.database.referencer_reference_references()},sheet_definition_ids_to_display_set:function(){return new Set(this.sheet.definition_ids_to_display)},sheet_definition_ids_referring_to_sheet_to_display_set:function(){return new Set(this.sheet.definition_ids_referring_to_sheet_to_display)},definitions_referring_to_sheet:function(){return this.database.definitions_referring_to(this.sheet)}},methods:{should_display_definition:function(e){return this.sheet_definition_ids_to_display_set.has(e._id)},should_display_definition_referring_to_sheet:function(e){return this.sheet_definition_ids_referring_to_sheet_to_display_set.has(e.definition._id)},update_color:function(e){this.sheet.hex_color=e.hex},record_focused:function(e){return!!this.current_focus&&e._id===this.current_focus.record_id},remove_row:function(e){confirm("Do you really want to delete this row?")&&this.sheet.remove_row(e)},remove_definition:function(e){this.sheet.delete_definition(e._id)},remove_sub_definition:function(e,t){this.sheet.delete_sub_definition(e,t)},focus_sheet_and_record:function(e,t,n){this.$emit("focus-sheet-and-record",e,t),this.currently_edited_record=null},add_reference:function(e,t,n){e.transform_value(t,(function(i){var r=new f.Reference(n,e,t,{});return null==i&&(i=[]),i.splice(i.length,1,r),i})),this.recompute_database_reference_referencer_references=this.recompute_database_reference_referencer_references+1},reference_record_selected:function(e,t,n){this.add_reference(e,t,n)},reverse_reference_record_selected:function(e,t,n){this.add_reference(n,t,e)},referencer_reference_references_for:function(e,t,n){var i=this.database_reference_referencer_references[n._id];return i&&i[t._id]||[]},referencer_reference_references_for_record_ids_to_skip:function(e,t,n){return[n._id].concat(_.default.map(this.referencer_reference_references_for(e,t,n),"source_record._id"))},set_filter:function(e,t){r.default.set(this.filters,e,t)},filtering_on:function(e){return this.filters[e]},values_for:function(e){return _.default(this.sheet.records).flatMap((function(t){return t.value_for_definition(e)})).compact().value()},source_values_for:function(e){return e.sheet.records},sortable:function(e){return"references"!==e.type},sort:function(e,t){var n=this,i=_.default(this.sheet.records).sortBy((function(t){return t.sort_value_for_definition(e,n.database)}));"desc"===t&&(i=i.reverse()),this.sheet.records=i.value()},transform_values:function(e,t,n){this.sheet.transform_values(e._id,t,n)},replace_definition:function(e,t){var n=_.default.findIndex(this.sheet.definitions,{_id:e});r.default.set(this.sheet.definitions,n,t)},edit_record:function(e){this.current_edit_new_record_position="top",this.currently_edited_record=e,this.$bvModal.show("edit-record-modal")},reverse_references_definition:function(e){return new f.ReferencesDefinition({_id:e.definition._id,type:"reverse_references",name:"".concat(e.sheet.name," - ").concat(e.definition.name),referenceable_sheet_ids:[e.sheet._id]})},add_record:function(e){var t=this.sheet.add_row(e);this.currently_edited_record=t,this.edit_record(t),this.current_edit_new_record_position=e},stop_editing_record:function(){this.currently_edited_record=null},set_currently_edited_definition:function(e){this.currently_edited_definition=e,this.currently_edited_reverse_definition=null},set_currently_edited_reverse_definition:function(e){this.currently_edited_definition=null,this.currently_edited_reverse_definition=e}}})},aa90:function(e,t,n){"use strict";n.r(t);var i=n("c727"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},ac57:function(e,t,n){"use strict";n.r(t);var i=n("db35"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},ad98:function(e,t,n){"use strict";var i=n("4514"),r=n.n(i);r.a},b18b:function(e,t,n){"use strict";n.r(t);var i=n("5e21"),r=n("8b22");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("3145");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"363a95bc",null);t["default"]=s.exports},b6c5:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",{staticClass:"input-group"},[n("input",{ref:"the_input",staticClass:"form-control",attrs:{type:"number"},domProps:{value:e.value},on:{input:e.update_value}})])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},ba75:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"input-group referenced-records"},[this.value.length?n("div",{class:{sheet:!0,valid:e.valid_sheet(e.sheet)}},[n("span",{staticClass:"sheet-name",style:"background-color:"+e.sheet.hex_color},[e._v(" "+e._s(e.sheet.name)+" ")]),e._l(e.value,(function(t){return n("div",{key:e.reference_key(t),staticClass:"referenced-record"},[n("a",{staticClass:"remove",on:{click:function(n){return n.stopPropagation(),e.remove(t)}}},[n("v-icon",{attrs:{name:"trash-2"}})],1),e.definition.definitions.length?n("a",{staticClass:"edit",on:{click:function(n){return n.stopPropagation(),e.edit_properties(t)}}},[n("v-icon",{attrs:{name:"edit"}})],1):e._e(),n("RecordResult",{attrs:{record:e.use_source_record?t.source_record:t.record,database:e.database},on:{"record-clicked":e.record_clicked}})],1)}))],2):e._e(),n("div",[n("b-modal",{attrs:{"ok-only":"",id:e.references_definition_edit_modal_id,title:"Edit reference properties"}},e._l(e.definition.definitions,(function(t){return n("div",{key:t._id},[e._v(" "+e._s(t.name)+" "),n("Field",{attrs:{record:e.currently_edited_reference,definition:t,database:e.database}})],1)})),0)],1)])},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},bd16:function(e,t,n){"use strict";var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",["string"===e.definition.type?n("String",{attrs:{value:e.record_value},on:{input:e.update_value}}):e._e(),"text_area"===e.definition.type?n("TextArea",{attrs:{value:e.record_value},on:{input:e.update_value}}):e._e(),e._v(" "),"integer"===e.definition.type?n("Integer",{attrs:{value:e.record_value},on:{input:e.update_value}}):e._e(),"select_one"===e.definition.type?n("SelectOne",{attrs:{value:e.record_value,definition:e.definition},on:{input:e.update_value}}):e._e(),"references"===e.definition.type&&e.record_value?e._l(e.grouped_references(),(function(t){return n("div",{key:t.sheet._id},[n("References",{attrs:{value:t.references,record:e.record,definition:e.definition,database:e.database,sheet:t.sheet},on:{"record-clicked":e.record_clicked}})],1)})):e._e(),"references"===e.definition.type?n("RecordsSearch",{attrs:{record_ids_to_skip:e.record_ids_to_skip(),database:e.database,sheet_ids_to_search:e.definition.referenceable_sheet_ids},on:{"record-selected":e.reference_record_selected}}):e._e(),"expression"===e.definition.type?n("Expression",{attrs:{value:e.record_value,definition:e.definition,database:e.database},on:{input:e.update_value}}):e._e()],2)},r=[];n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r}))},bd5b:function(e,t,n){"use strict";n.r(t);var i=n("3f84"),r=n("0cf2");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"7417dfed",null);t["default"]=s.exports},be4b:function(e,t,n){},c08e:function(e,t,n){"use strict";n.r(t);var i=n("bd16"),r=n("13c1");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"3d9d52e6",null);t["default"]=s.exports},c2ae:function(e,t,n){"use strict";n.r(t);var i=n("0e4e"),r=n("39aa");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"ac35ae54",null);t["default"]=s.exports},c5e8:function(e,t,n){"use strict";var i=n("9dd3"),r=n.n(i);r.a},c727:function(e,t,n){"use strict";n("4de4"),n("caad"),n("d3b7"),n("2532"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("2ef0"));t.default=r.default.extend({name:"SelectOne",props:["definition","database","values"],data:function(){return{items:a.default(this.values).uniq().sort().value()}},watch:{items:{handler:function(e,t){var n=this;this.items.length===this.choices().length?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(e){return a.default.filter(e,(function(e){return n.items.includes(e.value_for_definition(n.definition))}))}))},deep:!0}},methods:{choices:function(){return a.default(this.values).uniq().sort().value()},select_none:function(){this.items=[]},select_all:function(){this.items=this.choices()}}})},cbe0:function(e,t,n){"use strict";n.r(t);var i=n("089a"),r=n("d4f3");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"36802e6b",null);t["default"]=s.exports},cd49:function(e,t,n){"use strict";n("e623"),n("e379"),n("5dc8"),n("37e1"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("3dfd"));r.default.config.productionTip=!1,new r.default({render:function(e){return e(a.default)}}).$mount("#app")},cdf4:function(e,t,n){"use strict";n("4de4"),n("5db7"),n("d81d"),n("73d9"),n("d3b7"),n("6062"),n("3ca3"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importStar(n("a4c9")),o=i.__importDefault(n("2ef0")),s=i.__importDefault(n("fd1c")),u=i.__importDefault(n("4a8f")),d=i.__importDefault(n("6725")),c=i.__importDefault(n("f180")),l=function(e){return null==e||""===e||Array.isArray(e)&&0===e.length};t.default=r.default.extend({name:"DefinitionFilterModal",components:{Integer:s.default,References:u.default,SelectOne:d.default,Stringy:c.default},data:function(){return{last_input_value:null,blankness_filter:null}},props:{definition:Object,database:a.Database,values:Array,visible:Boolean},computed:{modal_dom_id:function(){return"definition-filter-modal-".concat(this.definition._id)},record_values:function(){return o.default.map(this.values,"record")}},methods:{handle_input:function(e,t){this.last_input_value=t,this.$emit("input",e,t)},show_only_blank:function(){var e=this,t=this.definition;this.blankness_filter=!0,this.$emit("input",this.definition._id,(function(n){return o.default.filter(n,e.blankness_filter_func(t))}))},show_only_non_blank:function(){var e=this,t=this.definition;this.blankness_filter=!1,this.$emit("input",this.definition._id,(function(n){return o.default.reject(n,e.blankness_filter_func(t))}))},blankness_filter_func:function(e){if("reverse_references"===e.type){var t=this.current_record_ids_referenced(e);return function(e){return!t.has(e._id)}}return function(t){return l(t.value_for_definition(e))}},reset_blank:function(){this.blankness_filter=null,this.$emit("input",this.definition._id,this.last_input_value)},current_record_ids_referenced:function(e){var t=o.default.chain(this.values).flatMap((function(t){return o.default.map(t.value_for_definition(e)||[],"record._id")})).uniq().compact().value();return new Set(t)}}})},cf20:function(e,t,n){},d1bf:function(e,t,n){"use strict";var i=n("360a"),r=n.n(i);r.a},d4f3:function(e,t,n){"use strict";n.r(t);var i=n("9862"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},d6dc:function(e,t,n){"use strict";n.r(t);var i=n("09d4"),r=n("38df");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"c3782dd4",null);t["default"]=s.exports},db35:function(e,t,n){"use strict";n("4de4"),n("d3b7"),n("ddb0"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e")),a=i.__importDefault(n("2ef0"));t.default=r.default.extend({name:"Integer",props:["definition","database","values"],data:function(){return{min:a.default.min(this.values),min_min:a.default.min(this.values),max:a.default.max(this.values),max_max:a.default.max(this.values)}},watch:{min:function(){this.emit_function()},max:function(){this.emit_function()}},methods:{reset:function(){this.min=this.min_min,this.max=this.max_max},emit_function:function(){var e=this,t=parseInt("".concat(this.min)),n=parseInt("".concat(this.max));t===this.min_min&&n===this.max_max?this.$emit("input",this.definition._id,null):this.$emit("input",this.definition._id,(function(i){return a.default.filter(i,(function(i){var r=i.value_for_definition(e.definition);return r>=t&&r<=n}))}))}}})},df79:function(e,t,n){"use strict";n.r(t);var i=n("ba75"),r=n("4036");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("68fb");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"55cbe97b",null);t["default"]=s.exports},e4a9:function(e,t,n){"use strict";n.r(t);var i=n("a855"),r=n.n(i);for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);t["default"]=r.a},e4b8:function(e,t,n){},e783:function(e,t,n){},f180:function(e,t,n){"use strict";n.r(t);var i=n("7c57"),r=n("776d");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"3ffefd5a",null);t["default"]=s.exports},f7cf:function(e,t,n){},fb57:function(e,t,n){"use strict";n("a9e3"),Object.defineProperty(t,"__esModule",{value:!0});var i=n("9ab4"),r=i.__importDefault(n("2b0e"));t.default=r.default.extend({name:"Integer",props:{value:Number},methods:{update_value:function(e){this.$emit("input",parseInt(e.target.value))}}})},fceb:function(e,t,n){"use strict";n.r(t);var i=n("936c"),r=n("e4a9");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);n("d1bf");var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"68a1708c",null);t["default"]=s.exports},fd1c:function(e,t,n){"use strict";n.r(t);var i=n("1e4b"),r=n("ac57");for(var a in r)"default"!==a&&function(e){n.d(t,e,(function(){return r[e]}))}(a);var o=n("2877"),s=Object(o["a"])(r["default"],i["a"],i["b"],!1,null,"33488f5a",null);t["default"]=s.exports}});
//# sourceMappingURL=app.55f4cc49.js.map